<doku:title parent="119" tags="documentation,iterator,media,append,node,front controller" title="Special-tags" urlname="Special-tags">
  This documentation page describes advanced functions of the framework, that are designed for special
  application cases of more complex software designs.
</doku:title>
<p>
   This documentation page describes advanced functions of the framework, that are designed for special
   application cases of more complex software designs.
</p>
<div class="hint">
   Please be aware, that within a tag definition only spaces are allowed as a separator. Tabs or new line characters
   are not parsed and using them can lead to unrecognized error on tag definition analysis!
</div>

<h3 id="Chapter-1-Iterator"><a href="#Chapter-1-Iterator">1. Iterator</a></h3>
<p>
   The iterator has been introduces to display lists of objects or associative arrays. The tag definition within a
   template file defines the output format and the controller delivers the data to display.
</p>

<h4 id="Chapter-1-1-Scheme"><a href="#Chapter-1-1-Scheme">1.1. Scheme</a></h4>
<p>
   The iterator tag's scheme is as follows:
</p>
<ul>
   <li>
      The surrounding <em>&lt;html:iterator /&gt;</em> tag defines a re-usable fragment within an APF template . The
      iterator's behavior is similar to an
      <int:link pageid="046" anchor="Chapter-2-3-Template">&lt;html:template /&gt; tag</int:link>. The latter one is
      re-usable, too, and is managed by a document controller and utilized to create output. In case the iterator is not
      told to create it's HTML representation by <em>HtmlIteratorTag::transformOnPlace()</em> or the output of
      <em>HtmlIteratorTag::transformIterator()</em> is injected into a place holder no output comes up.
   </li>
   <li>
      The <em>&lt;iterator:item /&gt;</em> tag describes a self-repeating element within the iterator. Within this tag
      you can add any HTML code, place holders and further tags to create output.
   </li>
   <li>
      If required, you may define a <em>&lt;iterator:fallback /&gt;</em> tag to generate an alternative output in case
      the iterator has received no content. This tag is based on the
      <int:link pageid="046" anchor="Chapter-2-3-Template">&lt;html:template /&gt; tag</int:link> and thus inherits all
      it's functionality that you might be already familiar wizj.
   </li>
   <li>
      The area within a <em>&lt;html:iterator /&gt;</em> tag and outside of <em>&lt;iterator:item /&gt;</em> you may
      define any HTML code as well as further place holders and custom tags to generate output.
   </li>
</ul>
<p>
   The definition of the tag is as follows:
</p>
<gen:highlight type="apf-xml">
&lt;html:iterator name=""&gt;
   ...
   [&lt;html:placeholder name="" /&gt;]
   [&lt;html:getstring namespace="" config="" entry="" /&gt;]
   [&lt;core:addtaglib class="" prefix="" name="" /&gt;]
   ...
   &lt;iterator:item [getter=""]&gt;
     ...
     &lt;html:placeholder name="" /&gt;
     [&lt;html:getstring namespace="" config="" entry="" /&gt;]
     [&lt;core:addtaglib class="" prefix="" name="" /&gt;]
     ...
   &lt;/iterator:item&gt;
   ...
   [&lt;iterator:fallback&gt;
      ...
      [&lt;html:placeholder name="" /&gt;]
      [&lt;html:getstring namespace="" config="" entry="" /&gt;]
      [&lt;core:addtaglib class="" prefix="" name="" /&gt;]
      ...
   &lt;/iterator:fallback&gt;]
   ...
&lt;/html:iterator&gt;
</gen:highlight>
<p>
   Within an <em>&lt;iterator:item /&gt;</em> tags any number of place holders (<em>&lt;html:placeholder /&gt;</em>)
   and HTML elements can be defined.
</p>
<strong>Description of the attributes:</strong>
<ul>
  <li>
    <strong>name</strong> (1): Name of the iterators. Used to refer to the desired instance with a controller.
    (<strong>Allowed characters</strong>: <code>[A-Za-z0-9]</code>)
  </li>
  <li>
    <strong>getter</strong>: Name of the method that is used to retrieve an object's attribute.
    (<strong>Allowed characters</strong>: <code>[A-Za-z0-9_]</code>)
  </li>
  <li>
    <strong>name</strong> (2): Name of the place holder.
    (<strong>Allowed characters</strong>: <code>[A-Za-z0-9]</code>)
  </li>
</ul>
<p>
   Details on the usage of the <em>&lt;iterator:item /&gt;</em> and the <em>&lt;iterator:fallback /&gt;</em> tags
   are contained in the following chapters.
</p>
<div class="hint">
   In order to display language dependent value within the iterator (e.g. for language dependent table
   headers), the <int:link pageid="046" anchor="Chapter-2-2-Getstring">&lt;html:getstring /&gt;</int:link> tag can be
   used. If you are not comfortable with this tag, feel free to add your custom tags using the
   <int:link pageid="046" anchor="Chapter-1-1-Addtaglib">&lt;core:addtaglib /&gt;</int:link> tag.
</div>

<h4 id="Chapter-1-2-Definition-of-the-data-structure"><a href="#Chapter-1-2-Definition-of-the-data-structure">1.2. Definition of the data structure</a></h4>
<p>
   The iterator deals with two kinds of content: associative arrays und object lists. Due to flexibility reasons, it is
   recommended to use object lists to have more flexibility creating templates within the <em>&lt;iterator:item /&gt;</em>
   tag (see <a href="#Chapter-1-2-2-Object-lists">chapter 1.2.2</a>).
</p>

<h5 id="Chapter-1-2-1-Associative-arrays"><a href="#Chapter-1-2-1-Associative-arrays">1.2.1. Associative arrays</a></h5>
<p>
   The iterator is built to handle associative arrays as data structure within an <em>&lt;iterator:item /&gt;</em>.
   Displaying a product list like
</p>
<gen:highlight type="apf-xml">
&lt;html:iterator name="products-list-simple"&gt;
   &lt;h2&gt;Products&lt;/h2&gt;
   &lt;p&gt;
      The following list contains our products:
   &lt;/p&gt;
   &lt;ul&gt;
   &lt;iterator:item&gt;
      &lt;li&gt;
         &lt;h3&gt;&lt;html:placeholder name="name" /&gt;&lt;/h3&gt;
         &lt;img src="&lt;html:placeholder name="img" /&gt;" /&gt;
         &lt;span&gt;&lt;html:placeholder name="price" /&gt;&lt;/span&gt;
      &lt;/li&gt;
   &lt;/iterator:item&gt;
   &lt;/ul&gt;
&lt;/html:iterator&gt;
</gen:highlight>
<p>
   the iterator expects you to provide the following data structure:
</p>
<gen:highlight type="php">
class IteratorTestController extends BaseDocumentController {

   public function transformContent() {

      $data = [
            [
                  'name'  => 'Cheap mobile phone',
                  'price' => '150€',
                  'img'   => 'cheapo.png'
            ],
            [
                  'name'  => 'Mid-range mobie phone',
                  'price' => '350€',
                  'img'   => 'mid-range.png'
            ],
            [
                  'name'  => 'Premium mobile phone',
                  'price' => '550€',
                  'img'   => 'premium.png'
            ]
      ];

      $iterator = &$this->getIterator('products-list-simple');
      $iterator->fillDataContainer($data);
      $iterator->transformOnPlace();

   }

}
</gen:highlight>
<div class="hint">
   Please note that the iterator expects a <em>numeric</em> list of items where each item contains an associative array
   containing the content. Associative lists including associative elements are not allowed.
</div>
<p>
   Method <em>fillDataContainer()</em> returns the instance of the iterator that has been defined within the current
   document and <em>transformOnPlace()</em> tells the iterator to display itself.
</p>
<p>
   All place holders (e.g. <em>&lt;html:placeholder name="name" /&gt;</em>) within an <em>&lt;iterator:item /&gt;</em>
   tag refer to the data structure values. The name of the array key must correspond to the value of the <em>name</em>
   attribute. Values that are not defined will be replaced by <em>null</em>.
</p>
<p>
   Besides the classic definition of place holders you may want to use the extended templating syntax within an
   <em>&lt;iterator:item /&gt;</em> tag:
</p>
<gen:highlight type="apf-xml">
&lt;html:iterator name="products-list-simple"&gt;
   &lt;h2&gt;Products&lt;/h2&gt;
   &lt;p&gt;
   The following list contains our products:
   &lt;/p&gt;
   &lt;ul&gt;
   &lt;iterator:item&gt;
      &lt;li&gt;
         &lt;h3&gt;&#36;{name}&lt;/h3&gt;
         &lt;img src="&#36;{img}" /&gt;
         &lt;span&gt;&#36;{price}&lt;/span&gt;
      &lt;/li&gt;
   &lt;/iterator:item&gt;
   &lt;/ul&gt;
&lt;/html:iterator&gt;
</gen:highlight>
<p>
   Details can be taken from chapter <int:link pageid="047" />.
</p>
<div class="hint">
   Using the extended templating syntax you can also use array access within one loop run as follows:
<gen:highlight type="apf-xml">
&lt;iterator:item&gt;
   &lt;li&gt;
      &lt;h3&gt;&#36;{item['name']}&lt;/h3&gt;
      &lt;img src="&#36;{item['img']}" /&gt;
      &lt;span&gt;&#36;{item['price']}&lt;/span&gt;
   &lt;/li&gt;
&lt;/iterator:item&gt;
</gen:highlight>
   The iterator stores the current object within data attribute <em>item</em> for each loop run. Mixing up all three
   variants (classic place holders, place holders using the extended templating syntax, and array access) is perfectly
   ok.
</div>

<h5 id="Chapter-1-2-2-Object-lists"><a href="#Chapter-1-2-2-Object-lists">1.2.2. Object lists</a></h5>
<p>
   Accessing object lists is similar to the approach described in <a href="#Chapter-1-2-1-Associative-arrays">chapter 1.2.1</a>.
   The only difference is the data type that is accessed which can be any type of object.
</p>
<p>
   Displaying a product list like
</p>
<gen:highlight type="apf-xml">
&lt;html:iterator name="products-list-objects"&gt;
   &lt;h2&gt;Products&lt;/h2&gt;
   &lt;p&gt;
   The following list contains our products:
   &lt;/p&gt;
   &lt;ul&gt;
   &lt;iterator:item&gt;
      &lt;li&gt;
         &lt;h3&gt;&lt;html:placeholder getter="getName" /&gt;&lt;/h3&gt;
         &lt;img src="&lt;html:placeholder getter="getImg" /&gt;" /&gt;
         &lt;span&gt;&lt;html:placeholder getter="getPrice" /&gt;&lt;/span&gt;
      &lt;/li&gt;
   &lt;/iterator:item&gt;
   &lt;/ul&gt;
&lt;/html:iterator&gt;
</gen:highlight>
<p>
   the iterator expects you to provide the following data structure:
</p>
<gen:highlight type="php">
class Article {

   private $name;
   private $price;
   private $img;

   public function __construct($name, $price, $img) {
      $this->name = $name;
      $this->price = $price;
      $this->img = $img;
   }

   public function getImg() {
      return $this->img;
   }

   public function getName() {
      return $this->name;
   }

   public function getPrice() {
      return $this->price;
   }

}

class IteratorTestController extends BaseDocumentController {

   public function transformContent() {

      $data = [
            new Article('Cheap mobile phone', '150€', 'cheapo.png'),
            new Article('Mid-range mobile phone', '350€', 'mid-range.png'),
            new Article('Premium mobile phone', '550€', 'premium.png')
      ];

      $iterator = &$this->getIterator('products-list-objects');
      $iterator->fillDataContainer($data);
      $iterator->transformOnPlace();

   }

}
</gen:highlight>
<div class="hint">
   Please note that the iterator expects a <em>numeric</em> list of items where each item contains an object
   containing the content. Associative lists including objects are not allowed.
</div>
<p>
   Method <em>getIterator()</em> returns the instance of the iterator that has been defined within the current
   document and <em>transformOnPlace()</em> tells the iterator to display itself.
</p>
<p>
   All place holders (e.g. <em>&lt;html:placeholder name="name" /&gt;</em>) within an <em>&lt;iterator:item /&gt;</em>
   tag refer to the object values. The name of the method called to retrieve the data is defined with attribute
   <em>getter</em> of the <em>&lt;iterator:item /&gt;</em> tag. Unknown methods lead to an <em>Exception</em>.
</p>
<p>
   Retrieving an object's attribute can be done in two ways:
</p>
<ul>
   <li>
      Using the <em>&lt;iterator:item/&gt;</em> tag you can define a generic method for all place holders. Doing so,
      you can specify the name of the attribute within the <em>&lt;html:placeholder/&gt;</em> tag using the
      <em>name</em> attribute. The value of this attribute then refers the object's property to display. Example:
<gen:highlight type="apf-xml">
&lt;html:iterator name="..."&gt;
 &lt;iterator:item getter="getProperty"&gt;
   &lt;html:placeholder name="DisplayName" /&gt;
 &lt;/iterator:item&gt;
&lt;/html:iterator&gt;
</gen:highlight>
      Within this mode the tag expects the current object to implement a method like
      <gen:highlight type="php">public function getProperty($name)</gen:highlight>
      that returns the value of the property (here <em>DisplayName</em>).
   </li>
   <li>
      Using the extended templating syntax you can also access content of an object within one loop run as follows:
<gen:highlight type="apf-xml">
&lt;iterator:item&gt;
   &lt;li&gt;
      &lt;h3&gt;&#36;{item-&gt;getName()}&lt;/h3&gt;
      &lt;img src="&#36;{item-&gt;getImg()}" /&gt;
      &lt;span&gt;&#36;{item-&gt;getPrice()}&lt;/span&gt;
   &lt;/li&gt;
&lt;/iterator:item&gt;
</gen:highlight>
      The iterator provides the current object within data attribute <em>item</em>.
   </li>
</ul>
<div class="hint">
   Mixing up the two options (generic getter and object access using the extended templating syntax) are also possible.
</div>

<h4 id="Chapter-1-3-Usage"><a href="#Chapter-1-3-Usage">1.3. Usage</a></h4>

<h5 id="Chapter-1-3-1-Definition-within-template"><a href="#Chapter-1-3-1-Definition-within-template">1.3.1. Definition within template</a></h5>
<p>
   Within your document controller you can use the following methods to control the iterator:
</p>
<gen:highlight type="php">
class ListController extends BaseDocumentController {

   public function transformContent() {

      // Get iterator from the current document
      $iterator = &$this->getIterator('...');

      // Pass data to the iterator (list of associative arrays or objects)
      $iterator->fillDataContainer(array(
         ...
      ));

      // Display iterators where it has been defined within the template or ...
      $iterator->transformOnPlace();

      // ... fill a place holder with the output
      $this->setPlaceHolder('...', $iterator->transformIterator());

   }

}
</gen:highlight>

<h5 id="Chapter-1-3-2-Numbering-lists"><a href="#Chapter-1-3-2-Numbering-lists">1.3.2. Numbering lists</a></h5>
<p>
   To number entries of a list or of a table you can may want to use a special place holder named <em>IterationNumber</em>
   within an <em>&lt;iterator:item /&gt;</em> tag. Example:
</p>
<gen:highlight type="apf-xml">
&lt;html:iterator name=""&gt;
  &lt;iterator:item [getter=""]&gt;
    &lt;html:placeholder name="IterationNumber"&gt;
  &lt;/iterator:item&gt;
&lt;/html:iterator&gt;
</gen:highlight>
<p>
   The start position of the counter can be changed within a controller as desired. For this reason, you might want to
   use <em>HtmlIteratorTag::setIterationNumber()</em> as follows:
</p>
<gen:highlight type="php">
class ListController extends BaseDocumentController {

   public function transformContent() {

      $iterator = &$this->getIterator('...');

      $iterator->fillDataContainer(array(
         ...
      ));

      $iterator->setIterationNumber(5);
      $iterator->transformOnPlace();

   }

}
</gen:highlight>
<p>
   Further options on tweaking this option can be taken from <a href="#Chapter-1-3-3-Using-the-pager">chapter 1.3.3</a>
   zu Rate.
</p>
<div class="hint">
   Defining place holder <em>IterationNumber</em> can be done as classic placeholder using a
   <em>&lt;html:placeholder /&gt;</em> tag as well as using the extended templating syntax.
</div>

<h5 id="Chapter-1-3-3-Using-the-pager"><a href="#Chapter-1-3-3-Using-the-pager">1.3.3. Using the pager</a></h5>
<p>
   Using the iterator in combination with the <int:link pageid="092" /> numbering of lists and tables can be continued on
   subsequent pages. To do so, the <em>&lt;html:iterator /&gt;</em> tag must be configured with the <em>pager</em>
   attribute. The value of the attribute refers to a configuration section for the pager.
</p>
<p>
   The following code block makes the iterator expect configuration file <em>/APF/config/modules/pager/{ENVIRONMENT}_pager.ini</em>
   being set up and containing a configuration section <em>PagerExample</em>:
</p>
<gen:highlight type="apf-xml">
&lt;html:iterator name="" pager="PagerExample"&gt;
  &lt;iterator:item [getter=""]&gt;
    &lt;html:placeholder name="IterationNumber"&gt;
  &lt;/iterator:item&gt;
&lt;/html:iterator&gt;
</gen:highlight>

<h5 id="Chapter-1-3-4-Definition-of-fallback-content"><a href="#Chapter-1-3-4-Definition-of-fallback-content">1.3.4. Definition of fallback content</a></h5>
<p>
   Displaying lists of various types of content somehow always includes displaying a fallback content. This use case
   can be mastered using the <em>&lt;iterator:fallback /&gt;</em> tag. The content defined within is displayed if the
   iterator has nothing to display.
</p>
<p>
   There are two options to manage behaviour of the iterator:
</p>
<ul>
   <li>
      <strong>normal</strong> (default): fallback content is displayed in addition to the HTML markup defined within
      the iterator.
   </li>
   <li>
      <strong>replace</strong>: alternative content completely replaces all HTML markup.
   </li>
</ul>
<p>
   The mode described above can be set using <em>&lt;html:iterator /&gt;</em>'s <em>fallback-mode</em> attribute.
</p>
<p>
   The following code block gives you an example for displaying a product list including an alternative content:
</p>
<gen:highlight type="apf-xml">
&lt;html:iterator name="products-list-simple" fallback-mode="replace"&gt;
   &lt;h2&gt;Products&lt;/h2&gt;
   &lt;p&gt;
   The following list contains our products:
   &lt;/p&gt;
   &lt;ul&gt;
   &lt;iterator:item&gt;
      &lt;li&gt;
         &lt;h3&gt;&lt;html:placeholder name="name" /&gt;&lt;/h3&gt;
         &lt;img src="&lt;html:placeholder name="img" /&gt;" /&gt;
         &lt;span&gt;&lt;html:placeholder name="price" /&gt;&lt;/span&gt;
      &lt;/li&gt;
   &lt;/iterator:item&gt;
   &lt;/ul&gt;
   &lt;iterator:fallback&gt;
      &lt;h2&gt;No products available&lt;/h2&gt;
      &lt;p&gt;
         Unfortunately, there are no products available.
         Please come back in &lt;html:placeholder name="count" /&gt; days.
   &lt;/p&gt;
   &lt;/iterator:fallback&gt;
&lt;/html:iterator&gt;
</gen:highlight>
<p>
   As long as products are available the product list is displayed. Otherwise, the alternative content replaces the
   list.
</p>
<p>
   Alternative content can be created and managed same as with <em>&lt;html:template /&gt;</em> tags. The following code
   block gives you an impression how to set the place holder within <em>&lt;iterator:fallback /&gt;</em> to express the
   number of days customers should wait until their return:
</p>
<gen:highlight type="php">
class ProductsController extends BaseDocumentController {

   public function transformContent() {

      $iterator = $this->getIterator('products-list-simple');

      ...

      $fallback = &$iterator->getFallbackContent();
      $fallback->setPlaceHolder('count', '3');

      $iterator->transformOnPlace();

   }

}
</gen:highlight>

<h5 id="Chapter-1-3-5-Evaluating-status-variables"><a href="#Chapter-1-3-5-Evaluating-status-variables">1.3.5. Evaluating status variables</a></h5>
<p>
   For each loop run, the iterator provides status variables. They can be used directly or within custom tags added to
   an item. All information is contained within the data attribute <em>status</em> containing an instance of
   <em>APF\tools\html\taglib\IteratorStatus</em>. This class offers the following methods:
</p>
<gen:highlight type="php">
class IteratorStatus {

   public function getCssClass() {
      return $this->cssClass;
   }

   public function isFirst($asString = false) {
      return $asString === false ? $this->isFirst : $this->convertToString($this->isFirst);
   }

   public function isLast($asString = false) {
      return $asString === false ? $this->isLast : $this->convertToString($this->isLast);
   }

   public function getItemCount() {
      return $this->itemCount;
   }

   public function getCounter() {
      return $this->counter;
   }

}
</gen:highlight>
<p>
   The following list describes how the above methods can be used for output generation:
</p>
<ul>
   <li>
      <strong>getCssClass()</strong>: returns a CSS class tailored to each loop run that can be used for formatting
      purposes. By default, it returns <em>first</em> for the first entry, <em>middle</em> for every subsequent one, and
      <em>last</em> for the last element of the list. The names of the CSS classes can be changed by the
      <em>first-element-css-class</em>, <em>middle-element-css-class</em>, and <em>last-element-css-class</em> attributes
      of the <em>&lt;html:iterator /&gt;</em> tag to fit your use cases.
   </li>
   <li>
      <strong>isFirst()</strong>: returns <em>true</em> in case the current element is the first one. Applying optional
      argument as <em>true</em> it returns no <em>boolean</em> value but a <em>string</em>. This is better for
      display purposes (e.g. as prefix/suffix of a CSS class) especially in case of returning <em>false</em>.
   </li>
   <li>
      <strong>isLast()</strong>: returns <em>true</em> in case the current element is the last one. Applying optional
      argument as <em>true</em> it returns no <em>boolean</em> value but a <em>string</em>. This is better for
      display purposes (e.g. as prefix/suffix of a CSS class) especially in case of returning <em>false</em>.
   </li>
   <li>
      <strong>getItemCount()</strong>: returns the total amount of items within the list.
   </li>
   <li>
      <strong>getCounter()</strong>: returns a sequential number that can be used for labelling purposes.
   </li>
</ul>
<p>
   The following example is designed to display a product list where the status object is used for formatting purposes:
</p>
<gen:highlight type="apf-xml">
&lt;html:iterator
      name="products-list-objects-extended"
      first-element-css-class="prd-first separator"
      middle-element-css-class="prd-center"
      last-element-css-class="prd-last"&gt;
   &lt;h2&gt;Products&lt;/h2&gt;
   &lt;p&gt;
   The following list contains our products:
   &lt;/p&gt;
   &lt;ul&gt;
      &lt;iterator:item&gt;
         &lt;li
               class="&#36;{status-&gt;getCssClass()}"
               data-item-count="&#36;{status-&gt;getItemCount()}"
               data-is-first="&#36;{status-&gt;isFirst(true)}"
               data-is-last="&#36;{status-&gt;isLast(true)}"&gt;
            &lt;h3&gt;(&#36;{item-&gt;getCounter()}) &#36;{item-&gt;getName()}&lt;/h3&gt;
            &lt;img src="&#36;{item-&gt;getImg()}" /&gt;
            &lt;span&gt;&#36;{item-&gt;getPrice()}&lt;/span&gt;
         &lt;/li&gt;
      &lt;/iterator:item&gt;
   &lt;/ul&gt;
&lt;/html:iterator&gt;
</gen:highlight>
<p>
   The corresponding HTML output is as follows (shortened):
</p>
<gen:highlight type="apf-xml">
<ul>
   <li
         class="prd-first separator"
         data-item-count="3"
         data-is-first="1"
         data-is-last="0">
      <h3>(1) Cheap mobile phone</h3>
      <img src="cheapo.png"/>
      <span>150€</span>
   </li>
   <li
         class="prd-center"
         data-item-count="3"
         data-is-first="0"
         data-is-last="0">
      <h3>(2) Mid-range mobile phone</h3>
      <img src="mid-range.png"/>
      <span>350€</span>
   </li>
   <li
         class="prd-last"
         data-item-count="3"
         data-is-first="0"
         data-is-last="1">
      <h3>(3) Premium mobile phone</h3>
      <img src="premium.png"/>
      <span>550€</span>
   </li>
</ul>
</gen:highlight>

<h5 id="Chapter-1-3-6-Stacking-of-iterators"><a href="#Chapter-1-3-6-Stacking-of-iterators">1.3.6. Stacking of iterators</a></h5>
<p>
   Displaying multi-dimensional lists iterators can be stacked. The following code block defines a two-dimensional data
   structure with women and men names including two examples each:
</p>
<gen:highlight type="php">
use APF\core\pagecontroller\BaseDocumentController;

class IteratorStackingController extends BaseDocumentController {

   public function transformContent() {

      $iterator = $this->getIterator('names');
      $iterator->fillDataContainer([
            [
                  'name' => 'Women names:',
                  'list' => [
                        ['name' => 'Maria'],
                        ['name' => 'Theodora']
                  ]
            ],
            [
                  'name' => 'Men names:',
                  'list' => [
                        ['name' => 'John'],
                        ['name' => 'George']
                  ]
            ]
      ]);

   }

}
</gen:highlight>
<p>
   In case you want to display the structure with an iterator, you may want to use the following template code:
</p>
<gen:highlight type="apf-xml">
&lt;html:iterator name="names" transform-on-place="true"&gt;
   &lt;ul&gt;
   &lt;iterator:item&gt;
      &lt;li&gt;
         &lt;item:fill-iterator name="examples" data="item['list']"/&gt;
         (${status-&gt;getCounter()}) ${item['name']}
         &lt;ul&gt;
            &lt;html:iterator name="examples" transform-on-place="true"&gt;
               &lt;iterator:item&gt;
                  &lt;li&gt;(${status-&gt;getCounter()}) ${item['name']}&lt;/li&gt;
               &lt;/iterator:item&gt;
            &lt;/html:iterator&gt;
         &lt;/ul&gt;
      &lt;/li&gt;
   &lt;/iterator:item&gt;
   &lt;/ul&gt;
&lt;/html:iterator>
</gen:highlight>
<p>
   The <em>&lt;item-fill-iterator /&gt;</em> tag initializes the iterator the same way <em>fillDataContainer()</em>
   does but in this case the stacked <em>examples</em> iterator. The tag uses data of the current loop run and injects
   the data contained in the <em>list</em> attribute into the stacked iterator.
</p>
<p>
   The <em>name</em> attribute of the <em>&lt;item-fill-iterator /&gt;</em> tag refers to the stacked iterator - in
   this case the <em>examples</em> iterator - and the <em>data</em> attribute is used to evaluate the data set to be
   injected into the stacked iterator. The syntax follows the extended templating syntax described in chapter
   <int:link pageid="161" />.
</p>
<p>
   The output of the list that is defined within the above controller is as follows:
</p>
<gen:highlight type="apf-xml">
&lt;ul&gt;
   &lt;li&gt;
      (1) Women names:
      &lt;ul&gt;
         &lt;li&gt;(1) Maria&lt;/li&gt;
         &lt;li&gt;(2) Theodora&lt;/li&gt;
      &lt;/ul&gt;
   &lt;/li&gt;
   &lt;li&gt;
      (2) Men names:
      &lt;ul&gt;
         &lt;li&gt;(1) John&lt;/li&gt;
         &lt;li&gt;(2) George&lt;/li&gt;
      &lt;/ul&gt;
   &lt;/li&gt;
&lt;/ul&gt;
</gen:highlight>
<div class="warn">
   Due to the fact that an iterator is controller by a document controller the stacked iterator must define attribute
   <em>transform-on-place</em> with value <em>true</em>. Otherwise, the iterator will not be displayed!
</div>
<div class="hint">
   The implementation described here allows to stack iterators several times. Please ensure that each stacked iterator is
   properly initialized.
</div>

<h3 id="Chapter-2-Mediastream"><a href="#Chapter-2-Mediastream">2. Media stream tags</a></h3>
<p>
   The media stream tags enable the developer to store and deliver GUI ressources directly from the
   namespace of a specific module. For this reason, the framework contains an abstract implementation
   of a streaming taglib and several dedicated taglibs, that generate a media url. Further, a generic
   front controller action is included, that streams the media files, that are requested by the tags.
</p>
<p>
   In order to use the tags you must be sure, that the front controller action, that is intended to
   deliver the desired files, has a valid configuration for the current context. The action config is
   expected to be contained in the
</p>
<gen:highlight type="code">/APF/config/tools/media/actions/{CONTEXT}/{ENVIRONMENT}_actionconfig.ini</gen:highlight>
<p>
   file. The content of the file can be taken from the following code box:
</p>
<gen:highlight type="ini">
[streamMedia]
ActionClass = "APF\tools\media\actions\StreamMediaAction"
</gen:highlight>
<p>
   A example configuration file is also included in the <strong>apf-configpack-*</strong> release
   file under <strong>tools/media/actions/</strong>.
</p>
<p>
   The following code box shows an real life application example:
</p>
<gen:highlight type="apf-xml">
&lt;html:form name="TestFormular"&gt;
   &lt;img src="&lt;html:mediastream
      namespace="APF\modules\mymodule\pres\images"
      filename="phone_icon.png"
   /&gt;" alt="" /&gt;
   &lt;form:text name="phonenumber" /&gt;
   &lt;br /&gt;
   &lt;form:button name="send" value="Absenden" /&gt;
&lt;/html:form&gt;
</gen:highlight>
<p>
   As you can take from the example above, the <em>&lt;html:mediastream /&gt;</em> tag expect the
   following attributes to be filled:
</p>
<ul>
  <li>
    <strong>namespace</strong>: Namespace to the desired media file.
    (<strong>Allowed characters</strong>: <code>[A-Za-z0-9:]</code>)
  </li>
  <li>
    <strong>filename</strong>: Name of the media file.
    (<strong>Allowed characters</strong>: <code>[A-Za-z0-9_.-]</code>)
  </li>
</ul>
<div class="hint">
   If you intend to manipulate the namespace of the file, that should be delivered, because you want to
   store the image files - using the context to give the application an individual touch - you have to act like this:
</div>
<ol>
  <li>
    Add an id attribute to the desired tag:
<gen:highlight type="apf-xml">
&lt;img src="&lt;html:mediastream
                     namespace="APF\modules\mymodule\pres\images"
                     filename="phone_icon.png"
                     id="PhoneIcon"
             /&gt;"
        alt=""
/&gt;
</gen:highlight>
  </li>
  <li>
    Manipulate the namespaces within the responsible document controller:
<gen:highlight type="php">
class ExampleController extends BaseDocumentController {

   public function transformContent(){
      $mediaStreamTag = &$this->getMediaStreamTagByID('PhoneIcon');
      $mediaStreamTag->setAttribute($mediaStreamTag->getAttribute('namespace').'\\'.$this->getContext());
   }

   private function &getMediaStreamTagByID($id){
      $children = &$this->getDocument()->getChildren();
      foreach($children as $objectId => $DUMMY){
         if(get_class($children[$objectId]) == 'MediaInclusionTag'){
            return $children[$objectId];
         }
      }
      throw new InvalidArgumentException('No media stream tag contained within the current document!');
   }
}
</gen:highlight>
  </li>
  <li>
      Manipulation of the file name within a template:
<gen:highlight type="php">
class ExampleController extends BaseDocumentController {

   public function transformContent() {
      $FileTemplate = &$this->getTemplate('file');
      $mediaStreamTag = &$this->getMediaStreamTagByID('FileIconID', $FileTemplate);
      $mediaStreamTag->setAttribute('extension', 'png');
      $mediaStreamTag->setAttribute('filebody', 'dateinameOhneEndung');
   }

   private function &getMediaStreamTagByID($id, TemplateTag &$template) {
      $children = &$template->getChildren();

      foreach ($children as $objectId => $DUMMY) {
         if (get_class($children[$objectId]) == 'MediaInclusionTag'
             && $children[$objectId]->getAttribute('id') == $id
         ) {
            return $children[$objectId];
         }
      }
      throw new InvalidArgumentException('No media stream tag contained within the current template "'
                                         . $template->getAttribute('name') . '"!');
   }
}
</gen:highlight>
  </li>
</ol>
<p>
   The front controller action that is used to deliver the media resources (<em>StreamMediaAction</em>) includes the
   possibility to explicitly configure allowed file extensions along with their MIME types. Thus, you can add or
   remove extensions. Within the default setup, the following types are allowed:
</p>
<ul>
   <li><em>png</em> or <em>image/png</em> respectively</li>
   <li><em>jpeg</em> or <em>image/jpg</em> respectively</li>
   <li><em>jpg</em> or <em>image/jpg</em> respectively</li>
   <li><em>gif</em> or <em>image/gif</em> respectively</li>
   <li><em>css</em> or <em>text/css</em> respectively</li>
   <li><em>js</em> or <em>text/javascript</em> respectively</li>
</ul>
<p>
   In order to re-define the existing values the configuration file <em>{ENVIRONMENT}_allowed_extensions.ini</em>
   must be present under <em>APF\tools\media\{CONTEXT}</em>. Within there, you can specify the allowed file extensions
   as follows:
</p>
<gen:highlight type="ini">
[Default]
jpg = "image/jpg"
xml = "text/xml"
psd = "application/psd"
</gen:highlight>

<h3 id="Chapter-3-Generic-importdesign-tag"><a href="#Chapter-3-Generic-importdesign-tag">3. Generic importdesign tag</a></h3>
<p>
   Within more complex applications it is often necessary to fill the views - defined with the
<strong>&lt;*:importdesign /&gt;</strong> tags - dynamically. In many cases, the developer thus wants
to use model information of the application. To be able, to use the business layer as a real control
layer, the framework features a generic importdesign tag, that allows you to retrieve the name of the
template to include as well as the template's namespace from the desired application model dynamically.
</p>
<p>
   The tag's signature looks like this:
</p>
<gen:highlight type="apf-xml">
&lt;generic:importdesign
   model-class=""
   model-mode="NORMAL|SINGLETON|SESSIONSINGLETON"
   namespace-param=""
   template-param=""
   [get-method=""]
   [dependent-action-namespace=""
   dependent-action-name=""
   [dependent-action-params=""]]
/&gt;
</gen:highlight>
<p>
   The attributes have the following meaning:
</p>
<ul>
  <li>
    <strong>model-class</strong>: Fully-qualified class name of the model class.
    (<strong>Allowed characters</strong>: <code>[A-Za-z0-9_\]</code>)
  </li>
  <li>
    <strong>model-mode</strong>: Creation mode of the model.
    (<strong>Allowed values</strong>: <code>NORMAL|SINGLETON|SESSIONSINGLETON</code>)
  </li>
  <li>
    <strong>namespace-param</strong>: Name of the model param, that returns the namespace of the template.
    (<strong>Allowed characters</strong>: <code>[A-Za-z0-9_.-]</code>)
  </li>
  <li>
    <strong>template-param</strong>: Name of the model param, that returns the name of the template.
    (<strong>Allowed characters</strong>: <code>[A-Za-z0-9_.-]</code>)
  </li>
  <li>
    <strong>get-method</strong>: Name of the model method, that should be used to query the template
    name and namespace of the template to include. Please note, that the method must expect one param
    that is given the value of the <em>namespaceparam</em> or <em>templateparam</em> attributes
    respectively and the tag expects that the function returns the value of the two parameters. By
    default, the <strong>getAttribute()</strong> function is used. (<strong>Allowed characters</strong>:
    <code>[A-Za-z0-9_]</code>)
  </li>
  <li>
    <strong>dependent-action-namespace</strong> / <strong>dependent-action-name</strong> /
    <strong>dependent-action-params</strong>: These three options are intended to automatically register
    an action with the front controller. This functionality is helpful, if a module is included by
    the tag and a front controller action is used for navigation purposes.
    <br />
    The attribute <strong>dependent-action-namespace</strong> defines the namespace of the action
    (e.g. <em>ACME\site\biz</em>) and <strong>dependent-action-name</strong> the name or the alias
    of the action (e.g. <em>Navigate</em>). <strong>dependent-action-params</strong> contains the
    params of the action like <strong>param1:value1|param2:value2</strong>. This format ist already
    known from the action configuration file layout.
  </li>
</ul>
<p>
   In order to use the tag, you must first add the tag by placing
</p>
<gen:highlight type="apf-xml">
&lt;core:addtaglib
   class="APF\tools\html\taglib\GenericImportTemplateTag"
   prefix="generic"
   name="importdesign"
/&gt;
</gen:highlight>
<p>
   before the tag definition.
</p>
<strong>Notes:</strong>
<ul>
  <li>
    As an real life application example the <int:link pageid="079"/> can be used. This article
    describes, how this documentation page is implemented and which tools of the framework are used.
  </li>
  <li>
    If a front controller action is used for navigation purposes, the action class must set the
    class variable <em>$keepInURL</em> to <em>true</em>. This causes the
    <int:link pageid="138">LinkGenerator</int:link> to include the action and it's params to be
    included while url generation.
  </li>
  <li>
    The registration of the action is only done, if the
    <strong>dependent-action-namespace</strong> and <strong>dependent-action-name</strong> attributes
    are present in the tag definition and the action was not registered before. The action params
    attribute is optional.
  </li>
</ul>

<h3 id="Chapter-4-Core-appendnode"><a href="#Chapter-4-Core-appendnode">4. core:appendnode tag</a></h3>
<p>
   Within a discussion about reusable template fragments (e.g. forms), the idea occurred to design a
   taglib, that can import various content to the scope of the current document. Thanks to the generic
   DOM structure of the GUI elements of the framework, this task is quite easy.
</p>
<p>
   In order to provide a generic and reusable function, the 1.8 branch now features the
   <em>&lt;core:appendnode /&gt;</em> tag, that can import any content from a defined template.
   To use the tag, you must provide two attributes similar to the importdesign tag:
   <em>namespace</em> and <em>template</em>.
</p>
<div class="hint">
   Besides, the optional attribute <em>includestatic</em> is available. It can be used to
   include all the content defined in the included template by setting it's value to <em>true</em>.
   In case the value contains any other value or the optional attribute is not defined, only the
   DOM nodes (instances of tags) of the included template are re-located.
</div>

<h4 id="Chapter-4-1-Inclusion-of-templates"><a href="#Chapter-4-1-Inclusion-of-templates">4.1. Inclusion of templates</a></h4>
<p>To include reusable fragments, the following code must be placed within the desired template:</p>
<gen:highlight type="apf-xml">
&lt;core:appendnode
   namespace="..."
   template="..."
   [includestatic="true" ]
/&gt;
</gen:highlight>
<p>
   If you want to reuse a special template, that is ised to display a domain object of your application,
   it is suitable to define this tag within a seperate template file (namespace:
   <em>APF\sites\testsite\pres\templates\generic</em>; template: <em>generic_templates</em>). The tag
   definition my look like this:
</p>
<gen:highlight type="apf-xml">
&lt;html:template name="ReusableTemplate"&gt;
  ...
  &lt;html:placeholder name="DisplayName"&gt;
  ...
&lt;/html:template&gt;
</gen:highlight>
<p>
   In order to use the html template within another template file, the fragment can be included
   using the following tag definitions:
</p>
<gen:highlight type="apf-xml">
&lt;core:appendnode
   namespace="APF\sites\testsite\pres\templates\generic"
   template="generic_templates"
/&gt;
</gen:highlight>

<h4 id="Chapter-4-2-Usage-of-the-imported-elements"><a href="#Chapter-4-2-Usage-of-the-imported-elements">4.2. Usage of the imported elements</a></h4>
<p>
   The usage of the elements imported by the <em>&lt;core:appendnode /&gt;</em> tag is identical
   to the previous approach. This is because the elements are directly appended to the current children
   list within the DOM tree. Especially, the document controller's methods (e.g. <em>getTemplate()</em>)
   can be used as well.
</p>
<p>To address the template printed in chapter 4.1, the following code snippet can be used:</p>
<gen:highlight type="php">
$tmpl = &$this->getTemplate('ReusableTemplate');
</gen:highlight>

<h4 id="Chapter-4-3-Important-notes"><a href="#Chapter-4-3-Important-notes">4.3. Important notes</a></h4>
<p>
   Due to the fact, that template parsing is done identically to the <em>&lt;core:importdesign /&gt;</em> tag.
</p>
<p>
   Further, the tag creates transformation marker tags within the origin template, to enable the
   <strong>transformOnPlace()</strong> feature of the included tags supporting this. Please be aware,
   that the sequence of definition is equal to the marker tag order!
</p>
<p>In case you want to include static content of the included template such as</p>
<gen:highlight type="apf-xml">
<div class="formattingContainer">
   &lt;html:template name="ReusableTemplate"&gt;
     ...
   &lt;/html:template&gt;
</div>
</gen:highlight>
<p>
   <em>includestatic</em> must be set to <em>true</em>.
</p>

<core:importdesign namespace="APF\modules\comments\pres\templates" template="comment" categorykey="en_078" />