<doku:title tags="documentation,module,captcha,guestbook,pager,comment,social bookmarking,usermanagement" title="Module - usermanagement" urlname="Module-usermanagement">
  Generic user management modul.
</doku:title>
<core:importdesign namespace="sites::apfdocupage::pres::templates::perspectives::content::voting" template="voting" />
The <strong>usermanagement</strong> modul contains a backend for user administration and a generic
business component - based on the
<a href="./?Page=063-Generic-OR-mapper" title="GenericORMapper">GenericORMapper</a>
- that can be used for authentication purposes and to manage the users, groups, roles, permissions
and permission sets. The built-in module is aimed to standardize user management. On the other
hand, it is intended to be a reliable and reusable tool for this central issue, that eases daily work.
<br />
<br />
The following chapters describe the design of the module and present examples for usage of the
business component and the Inclusion of the backend into existing applications.
<br />
<br />
<br />
<a name="1-Design"></a><h3>1. Design of the module</h3>
The module consists of a business component, the <strong>UmgtManager</strong>, and a management
backend. The manager uses the <strong>GenericORMapper</strong> as the data layer component. The
backend is completely based on the business layer of the module. This means, that other applications
or modules can use the <strong>UmgtManager</strong> as a fully qualified business component for
authentication and user management purposes.
<br />
<br />
<br />
<a name="1-1-Datamodel"></a><h4>1.1. Datamodel</h4>
The data model contains fife different objects:
<ul>
  <li>User</li>
  <li>Grouos</li>
  <li>Roles</li>
  <li>Permission sets</li>
  <li>Permissions</li>
</ul>
The separation in these five types makes a granular and generic usermanagement possible. The following
UML diagram shows the objects mentioned and the relations between them:
<br />
<br />
<img src="http://media.adventure-php-framework.org/content/usermanagement_domain_model.png" alt="Usermanagement UML Diagramm (APF)" style="width: 560px;" />
<br />
<br />
<strong>Note:</strong> Groups are typically used to represent permissions on <strong>objects</strong>,
roles are aimed to control permissions on <strong>functions</strong>. To be able to reuse permission
definitions within different roles, the <strong>permission set</strong> was introduced. This container
encapsulated one or more permissions, that can thus be assignet to a role.
<br />
<br />
<br />
<a name="1-2-UmgtManager"></a><h4>1.2. UmgtManager</h4>
The business component features a set of methods, that provide abstract data access to the data model
presented above. The list does not only contain CRUD functionality but also functions to create,
read, update and delete relations between the objects. Futher, functions for user authentication and
effective usage of the usermanagement have been implemented.
<br />
<br />
The following list gives you a overview of the API methods available. Details can be taken from the
API documentation of the <strong>UmgtManager</strong> class:
<ul style="line-height: 20px;">
  <li><strong>loadUserByEMailAndPassword()</strong>: Loads a user object by email and password.</li>
  <li><strong>loadUserByUsernameAndPassword()</strong>: Loads a user object by username and password.</li>
  <li><strong>loadUserPermissions()</strong>: Loads the list of permissions a user has got.</li>
  <li><strong>saveUser($user)</strong>: Saves a user object within the current application.</li>
  <li><strong>saveGroup($group)</strong>: Saves a group object within the current application.</li>
  <li><strong>saveRole($role)</strong>: Saves a role object within the current application.</li>
  <li><strong>savePermissionSet($permissionSet)</strong>: Saves a permission set object within the current application.</li>
  <li><strong>savePermission($permission)</strong>: Saves a permission object within the current application.</li>
  <li><strong>getPagedUserList()</strong>: Returns a list of users concerning the current page.</li>
  <li><strong>getPagedGroupList()</strong>: Returns a list of groups concerning the current page.</li>
  <li><strong>getPagedRoleList()</strong>: Returns a list of roles concerning the current page.</li>
  <li><strong>getPagedPermissionSetList()</strong>: Returns a list of permission sets concerning the current page.</li>
  <li><strong>getPagedPermissionList()</strong>: Returns a list of permissions concerning the current page.</li>
  <li><strong>loadUserByID($userID)</strong>: Returns a user domain object.</li>
  <li><strong>loadGroupByID($groupID)</strong>: Returns a group domain object.</li>
  <li><strong>loadRoleByID($roleID)</strong>: Returns a role domain object.</li>
  <li><strong>loadPermissionSetByID($permissionSetID)</strong>: Loads a permission set by it's id.</li>
  <li><strong>loadPermissionList()</strong>: Loads a list of permissions of the current application.</li>
  <li><strong>loadPermissionByID($permID)</strong>: Loads a permission by it's id.</li>
  <li><strong>loadRolesNotWithPermissionSet($permissionSet)</strong>: Loads a list of roles, that are not associated with the permission set.</li>
  <li><strong>loadRolesWithPermissionSet($permissionSet)</strong>: Loads a list of roles, that are associated with the permission set.</li>
  <li><strong>assignPermissionSet2Roles($permissionSet,$roles)</strong>: Associates a given permission set to a list of roles.</li>
  <li><strong>detachPermissionSetFromRoles($permissionSet,$roles)</strong>: Removes a given permission set from a list of roles.</li>
  <li><strong>deleteUser($user)</strong>: Deletes a user.</li>
  <li><strong>deleteGroup($group)</strong>: Deletes a group.</li>
  <li><strong>deleteRole($role)</strong>: Deletes a role.</li>
  <li><strong>deletePermissionSet($permissionSet)</strong>: Deletes a PermissionSet.</li>
  <li><strong>deletePermission($permission)</strong>: Deletes a Permission.</li>
  <li><strong>assignUser2Groups($user,$groups)</strong>: Associates a user with a list of groups.</li>
  <li><strong>assignUsers2Group($users,$group)</strong>: Associates users with a group.</li>
  <li><strong>assignRole2Users($role,$users)</strong>: Associates a role with a list of users.</li>
  <li><strong>loadGroupsWithUser(&$user)</strong>: Loads all groups, that are assigned to a given user.</li>
  <li><strong>loadGroupsNotWithUser(&$user)</strong>: Loads all groups, that are not assigned to a given user.</li>
  <li><strong>loadUsersWithGroup(&$group)</strong>: Loads all users, that are assigned to a given group.</li>
  <li><strong>loadUsersNotWithGroup(&$group)</strong>: Loads all users, that are not assigned to a given group.</li>
  <li><strong>loadRolesWithUser(&$user)</strong>: Loads all roles, that are assigned to a given user.</li>
  <li><strong>loadRolesNotWithUser(&$user)</strong>: Loads all roles, that are not assigned to a given user.</li>
  <li><strong>loadUsersWithRole(&$role)</strong>: Loads a list of users, that have a certail role.</li>
  <li><strong>loadUsersNotWithRole(&$role)</strong>: Loads a list of users, that don't have the given role.</li>
  <li><strong>loadPermissionsOfPermissionSet(&$permissionSet)</strong>: Loads the permissions associated with a permission set.</li>
  <li><strong>detachUserFromRole($user,$role)</strong>: Detaches a user from a role.</li>
  <li><strong>detachUsersFromRole($users,$role)</strong>: Detaches users from a role.</li>
  <li><strong>detachUserFromGroup($user,$group)</strong>: Removes a user from the given groups.</li>
  <li><strong>detachUserFromGroups($user,$groups)</strong>: Removes a user from the given groups.</li>
  <li><strong>detachUsersFromGroup($users,$group)</strong>: Removes users from a given group.</li>
  <li><strong>loadUserByFirstName($firstName)</strong>: Loads a user by it's first name.</li>
  <li><strong>loadUserByLastName($lastName)</strong>: Loads a user by it's last name.</li>
  <li><strong>loadUserByEMail($email)</strong>: Loads a user by it's email.</li>
  <li><strong>loadUserByFirstNameAndLastName($firstName,$lastName)</strong>: Loads a user by it's first and last name.</li>
  <li><strong>loadUserByUserName($username)</strong>: Loads a user by it's user name.</li>
</ul>
<br />
<a name="2-Installation"></a><h3>2. Installation</h3>
The installation contains three major steps:
<ul>
  <li>Configuration of the module itself</li>
  <li>Configuration of the GenericORMappers</li>
  <li>Installation of the database</li>
</ul>
<br />
<a name="2-1-Configuration-module"></a><h4>2.1. Configuration of the module</h4>
The configuration file of the usermanagement module covers three params: the key of the database
connection, the id of the application container and the service mode, that is used to create the
OR mapper instance:
<code:highlight>
[InstanceName]
ConnectionKey = ""
ApplicationID = ""
ServiceMode = ""
</code:highlight>
The <em>adventure-configpack-*</em> package contains an example configuration file with a detailed
description of the params.
<br />
<br />
Due to the fact, that the data object model features an <strong>Application</strong> object, the
usermanagement can be used for several applications at the same time and the same database. This
again enables you to create a common user database for different applications or modules and reuse
users within them. When using the <em>UmgtManager</em>, the <strong>ApplicationID</strong> must be
defined, that the component knows, which application instance should be used.
<br />
<br />
<br />
<a name="2-2-Configuration-OR-Mapper"></a><h4>2.2. Configuration of the OR mapper</h4>
Because of the fact, that the module is completely based on the
<a href="./?Page=063-Generic-OR-mapper" title="GenericORMapper">GenericORMapper</a>
a set of configuration files must be provided for the UML above. To ease setup, the
<em>adventure-configpack-*</em> package contains the configuration files, that are necessary to setup
the OR mapper. The files located under <strong>/modules/usermanagement/</strong> must therefor be
copied into the correct <strong>config</strong> namespace. Please be aware, that the configuration
files must be located within the correct context folder. Details can be taken from the
<a href="./?Page=033-Configuration#2-Naming-conventions" title="configuration">configuration</a>
chapter.
<br />
<br />
As you can read about in the
<a href="./?Page=063-Generic-OR-mapper#2-3-Object-and-relation-definition" title="GenericORMapper">GenericORMapper</a>
documentation, a pair of configuration files is used to define the objects and relations available
within one onstance of the mapper.
<br />
<br />
<br />
<a name="2-3-Installation-database"></a><h4>2.3. Installation of the database</h4>
As a last step, the database must be prepared. For this reason, the
<strong>/modules/usermanagement/data/scripts/setup.sql</strong> script must be executed against the
desired database. After that, the module is ready for use.
<br />
<br />
It is recommended to use a seperate database for the module. Basically, there is no restriction
installing the tables within an existing database. Because of the usage of the
<a href="./?Page=031-Class-reference-table-connectionManager" title="ConnectionManager">ConnectionManager</a>,
within one application multiple databases can be addressed.
<br />
<br />
<br />
<a name="3-Usage"></a><h3>3. Usage</h3>
<a name="3-1-Backend"></a><h4>3.1. Backend</h4>
In order to use the integrated backend, a seperate bootstrap file must be created or the application
can be integrated within another using taglibs.Thanks to the generic implementation, the url creation
recognizes external params (e.g. for navigation purposes).
<br />
<br />
Because the backend is completely based on the front controller (e.g. displaying of the icons is
realized by the
<a href="./?Page=078-Special-taglibs#2-Mediastream" title="Mediastream tags">&lt;*:mediastream /&gt;</a>
tags), the <em>index.php</em> must contain the following code:
<php:highlight>
include('./apps/core/pagecontroller/pagecontroller.php');
import('core::frontcontroller','Frontcontroller');
$fC = &Singleton::getInstance('Frontcontroller');
$fC->set('Context',{CONTEXT});
$fC->start('modules::usermanagement::pres::templates','main');
</php:highlight>
If the backend should be included as a view, the following tag definition can be used:
<code:highlight>
&lt;core:importdesign namespace="modules::usermanagement::pres::templates" template="main" /&gt;
</code:highlight>
In case, the application the usermanagement is integrated in is based on a front controller action
that is used for navigation, the module must be included using the
<strong>&lt;generic:importdesign /&gt;</strong> tag. Please note, that the navigation action class
must then be defined with <strong>$__KeepInURL = true</strong> to enable the Link creation method
to include these params. If not, navigation probably is not working.
<code:highlight>
&lt;core::addtaglib namespace="tools::html::taglib" prefix="generic" class="importdesign" /&gt;
&lt;generic:importdesign
   modelnamespace="namespace::to::application::model"
   modelfile="ModelName"
   modelclass="ModelName"
   modelmode="SINGLETON"
   namespaceparam="..."
   templateparam="..."
   dependentactionnamespace="namespace::to::dependent::action"
   dependentactionname="DependentActionName"
   dependentactionparams="param1:value1|param2:value2"
/&gt;
</code:highlight>
Details on the tag can be taken from the
<a href="./?Page=078-Special-taglibs#3-Generic-importdesign-tag" title="special taglibs chapter">special taglibs chapter</a>.
<br />
<br />
As mentioned above, the image and icon delivery of the module is done by <em>&lt;*:mediastream /&gt;</em>
tags. These tags generate an image source url, that contains a front controller action directive. As
described in the
<a href="./?Page=012-Frontcontroller#2-2-Configuration" title="Front controller">front controller chapter</a>,
every action must be defined within a configuration file. To enable the image display, please create
the configuration file
<code:highlight>{ENVIRONMENT}_actionconfig.ini</code:highlight>
within the namespace
<code:highlight>
/config/tools/media/actions/{CONTEXT}/
</code:highlight>
The content of the file is as follows:
<code:highlight>
[streamMedia]
FC.ActionNamespace = "tools::media::actions"
FC.ActionFile = "StreamMediaAction"
FC.ActionClass = "StreamMediaAction"
FC.InputFile = "StreamMediaInput"
FC.InputClass = "StreamMediaInput"
FC.InputParams = ""
</code:highlight>
Details on the naming of configuration files can be taken from the corresponding
<a href="./?Page=033-Configuration#2-Naming-conventions" title="Configuration">configuration chapter</a>.
<br />
<br />
<br />
<a name="3-2-Business-component"></a><h4>3.2. Business component</h4>
The API of the <strong>UmgtManager</strong> class basically works with objects. This means, that
arguments applied to the class' methods must be instances of the <strong>GenericDomainObject</strong>
class. Return values are also instances or lists of <strong>GenericDomainObject</strong> objects or
<strong>null</strong>.
<br />
<br />
<br />
<a name="3-2-1-Login-user"></a><h5>3.2.1. Login via username and password</h5>
The following example shows, how easily authentication can be done by URL values:
<php:highlight>
// include business component prior to use
import('modules::usermanagement::biz','umgtManager');

// get the business object
$uM = &$this->__getAndInitServiceObject('modules::usermanagement::biz','umgtManager','Default');

// retrieve the username and password from the request
$username = RequestHandler::getValue('user');
$password = RequestHandler::getValue('pass');

// try to get the user object. if null ist returned, the credentials are not correct
$user = $uM->loadUserByUsernameAndPassword($username,$password);
if($user !== null){
   echo 'user "'.$user->getProperty('DisplayName').'" is logged in';
 // end if
}
else{
   echo 'user could not be logged in with the given credentials';
 // end else
}
</php:highlight>
<br />
<a name="3-2-2-Login-E-Mail"></a><h5>3.2.2. Login via email and password</h5>
In order to authenticate by email and password, the
<php:highlight>
$user = $uM->loadUserByUsernameAndPassword($username,$password);
</php:highlight>
call must be replaced by
<php:highlight>
$user = $uM->loadUserByEMailAndPassword($email,$password);
</php:highlight>
<br />
<a name="3-2-3-Groups-and-roles"></a><h5>3.2.3. Loading of groups and roles</h5>
If a user was authenticated succesfully by the methods described in 3.2.1 and 3.2.2, the user's
groups and roes can be loaded as follows:
<php:highlight>
// load groups
$groups = $uM->loadGroupsWithUser($user);

// load roles
$roles = $uM->loadRolesWithUser($user);
</php:highlight>
<br />
<a name="3-2-4-User-permissions"></a><h5>3.2.4. Loading of user permissions</h5>
If the developer needs to access the user's function permissions, these can be accesed via the
associated roles or the API method intended for this task:
<php:highlight>
// load permissions via the relevant relations
$roles = $uM->loadRolesWithUser($user);

$permissions = array();
for($i = 0; $i < count($roles); $i++){

   // load permission sets
   $permSets = $roles[$i]->loadRelatedObjects('Role2PermissionSet');

   for($j = 0; $j < count($permSets); $j++){
      $permissions = array_merge($permissions,$permSets[$j]->loadRelatedObjects('PermissionSet2Permission'));
    // end for
   }

 // end for
}
// call the api method
$permissions = $uM->loadUserPermissions($user);
</php:highlight>
The disatvantage of the first variant is, that permissions may apear twice ore more with in the
list of permissions, because one or more roles can have the same permissions associated.
<br />
<br />
<br />
<a name="3-2-5-Manipulation-objects"></a><h5>3.2.5. Manipulation of objects</h5>
For the manipulation of objects a couple of methods are included in the API. The following code box
depicts, how user, groups and roles can be created, updated and deleted. Because of the fact, that
all business objects are instances of the <strong>GenericDomainObject</strong> class, the developer
must take care, that the name of the desired object is set correctly dusing instanciation. The name
must be equal to the object's name within the configuration. The same is true for the attributes.
Details can be taken from the
<a href="./?Page=063-Generic-OR-mapper#2-3-1-Object-definition" title="Object definition">object definition chapter</a>
on the OR mapper documantation page.
<php:highlight>
// get the business object
$uM = &$this->__getAndInitServiceObject('modules::usermanagement::biz','umgtManager','Default');

// create new user
$user = new GenericDomainObject('User');
$user->setProperty('FirstName','John');
$user->setProperty('LastName','Doe');
$user->setProperty('Username','jdoe');
$uM->saveUser($user);

// create new group
$group = new GenericDomainObject('Group');
$group->setProperty('DisplayName','Users');
$uM->saveGroup($group);

// load a user and change username
$user = $uM->loadUserByID(1);
$user->setProperty('Username','johndoe');
$uM->saveUser($user);

// load a group and change display name
$group = $uM->loadGroupByID(2);
$group->setProperty('DisplayName','Forum users');
$uM->saveGroup($group);

// delete a user
$users = $uM->getPagedUserList();
for($i = 0; $i < count($users); $i++){
   if($users[$i]->getProperty('Username') === 'johndoe'){
      $user = $users[$i];
   }
}
$uM->deleteUser($user);

// delete a group
$groups = $uM->getPagedGroupList();
for($i = 0; $i < count($groups); $i++){
   if($groups[$i]->getProperty('DisplayName') === 'Forum users'){
      $group = $groups[$i];
   }
}
$uM->deleteGroup($group);
</php:highlight>
<br />
<a name="3-2-6-Manipulation-relations"></a><h5>3.2.6. Manipulation of relations</h5>
In order to create, modify and delete relations between the objects managed by the OR mapper
(see <a href="#1-1-Datamodel" title="UML diagram">UML</a> for details), the developer is provided
several functions. These are focused on the dedicated application use case and expect instances of
the <strong>GenericDomainObject</strong> as arguments. The follwing code boy describes several
use cases:
<php:highlight>
// get the business object
$uM = &$this->__getAndInitServiceObject('modules::usermanagement::biz','umgtManager','Default');

// add user to group
$user = $uM->loadUserByID(1);
$group = $uM->loadGroupByID(2);
$uM->assignUser2Groups($user,array($group));

// assign a dedicated role to a user
$role = $uM->loadRoleByID(3);
$uM->assignRole2Users($role,array($user));

// remove user from group
$uM->detachUserFromGroups($user,array($group));

// detatch role from user
$uM->detachUserFromRole($user,$role);
</php:highlight>
<br />
<a name="3-2-Direct-access"></a><h4>3.2. Direct access</h4>
If the API of the <strong>UmgtManager</strong> does not support a special case, the
<strong>GenericORMapper</strong> can be used to directly access the database. Please be aware to use
the same configuration files, you took for the usermanagement setup to ensure data consistency. The
next code example shows you how to create the OR mapper instance:
<php:highlight>
$oRMFact = &$this->__getServiceObject(
                       'modules::genericormapper::data',
                       'GenericORMapperFactory'
                                     );
$oRM = &$oRMFact->getGenericORMapper(
                       'modules::usermanagement',
                       'umgt',
                       $connectionKey,
                       $serviceMode
                                    );
</php:highlight>
The params <strong>$connectionKey</strong> and <strong>$serviceMode</strong> must be filled with the
values of the
<a href="#2-1-Configuration-module" title="2.1. Configuration of the module">configuration file</a>
of the usermanagement module. The <em>ServiceMode</em> directive is optional.
<br />
<br />
After creating the mapper it can be used concerning the configuration files. The following source
code example counts the users within on group. The <strong>$oRM</strong> contains a mapper instance
as defined above.
<php:highlight>
$group = $oRM->loadObjectByID('Group',1);
$count = $oRM->loadRelationMultiplicity($group,'Group2User');
</php:highlight>
If you want to test, if a user is included in a dedicated group or if it has associated a dedicated
role, the following code can be used:
<php:highlight>
// test, if user is within group
$group = $oRM->loadObjectByID('Group',1);
$user = $oRM->loadObjectByID('User',2);
if($oRM->isAssociated('Group2User',$group,$user)){
   echo 'user is in group';
}
else{
   echo 'user is *not* in group';
}

// test, if user is associated with the desired role
$role = $oRM->loadObjectByID('Role',3);
if($oRM->isAssociated('Role2User',$role,$user)){
   echo 'user is associated the desired role';
}
else{
   echo 'user is *not* associated the desired role';
}
</php:highlight>
In order to freely define the selection criterions, the <strong>GenericORMapper</strong> features
the methods
<ul>
  <li>loadObjectByStatement()</li>
  <li>loadObjectByTextStatement()</li>
  <li>loadObjectByCriterion()</li>
  <li>loadObjectListByStatement()</li>
  <li>loadObjectListByTextStatement()</li>
  <li>loadObjectListByCriterion()</li>
</ul>
These functions expect sql statements or a
<a href="./?Seite=063-Generischer-OR-Mapper#5-GenericCriterionObject" title="GenericCriterionObject">GenericCriterionObject</a>.
To load all permissions associated with one role, you can use this code snippet:
<php:highlight>
// define statement
$select = 'SELECT `ent_permission`.* FROM `ent_permission`
           INNER JOIN ass_permissionset2permission ON ent_permission.PermissionID = ass_permissionset2permission.PermissionID
           INNER JOIN ent_permissionset ON ass_permissionset2permission.PermissionSetID = ent_permissionset.PermissionSetID
           INNER JOIN ass_role2permissionset ON ent_permissionset.PermissionSetID = ass_role2permissionset.PermissionSetID
           INNER JOIN ent_role ON ass_role2permissionset.RoleID = ent_role.RoleID
           WHERE ent_role.RoleID = '1'
           GROUP BY ent_permission.PermissionID;';

// load permission list
$permissions = $oRM->loadObjectListByTextStatement('Permission',$select);
</php:highlight>
To get a list of available application containers, the following code can be used:
<php:highlight>
$apps = $oRM->loadObjectListByCriterion('Application');
</php:highlight>
Details on the objects, attributes and relations of the module can be taken from the
<a href="#2-1-Configuration-module" title="2.1. Configuration of the module">configuration file</a>
or the <a href="#1-1-Datamodel" title="UML diagram">UML diagram</a>. The usage of the OR mapper can
be read about in the
<a href="./?Page/063-Generic-OR-mapper#1-Introduction" title="GenericORMapper - introduction">GenericORMapper</a>
chapter.
<br />
<br />
<br />
<a name="4-Extension"></a><h3>4. Extension</h3>
<a name="4-1-Password-encryption"></a><h4>4.1. Password encryption</h4>
<a name="4-1-1-Enhancement-of-the-manager"></a><h5>4.1.1. Enhancement-of-the-manager</h5>
<div class="hint">
   This section describes the implementation up to version 1.10. This is true for greater versions,
   but there, the prefered method is to implement a custom password hash provider as describes in
   the next chapter.
</div>
<br />
The business component uses the <strong>MD5</strong> algorithm to create a password hash. If you
intend to change this behaviour (e.g. to <em>SHA1</em>), this goal can be achieved by extending the
<strong>umgtManager</strong> class and overwrite the <strong>__createPasswordHash()</strong> method.
Please be aware, that the new class does not overwrite the <strong>init()</strong> function.
<br />
<br />
The new class can be used exactly as the old one. The following example shows, how you can change the
hashing algo:
<php:highlight>
class MyUmgtManager extends umgtManager {
   function __createPasswordHash($password){
      return sha1($password);
   }
}
$umgt = &$this->__getAndInitServiceObject('my::namespace','MyUmgtManager','Default');
$user = $umgt->loadUserByID(5);
</php:highlight>
<a name="4-1-2-Implementation-of-the-PasswordHashProvider"></a><h5>4.1.2. Implementation of the PasswordHashProvider</h5>
Since version <strong>Version 1.11</strong>, you can define your own <strong>PasswordHashProvider</strong>
within the configuration file of the usermanagement module. This component is responsible for creating
a password hash for the <strong>umgtManager</strong>. In default case, <strong>md5</strong> is used
so far.
<br />
<br />
In order to provide a custom password hash component, a new PHP class must be created implementing
the <em>PasswordHashProvider</em> interface. It defines a method, that calculates a hash key out of
a given clear text password. Going along with the above example, the class is as follows:
<php:highlight>
import('modules::usermanagement::biz','PasswordHashProvider');
class Sha1PasswordHashProvider implements PasswordHashProvider {
   public function createPasswordHash($password){
      return sha1($password);
   }
}
</php:highlight>
To activate this provider, the configuration must be added the two directies, that specify the
namespace and (class) name of the component:
<code:highlight>
PasswordHashProvider.Namespace = "my::namespace"
PasswordHashProvider.Class = "Sha1PasswordHashProvider"
</code:highlight>
Complete usermanagement sample configuration files can be found in the
<strong>apf-configpack-*</strong> release packages.
<br />
<br />
<br />
<a name="4-2-Display-name-manipulation"></a><h4>4.2. Display name manipulation</h4>
The display name of a user is generated as
<code:highlight>{last name}, {first name}</code:highlight>
by default. In order to influence this, the <strong>umgtManager</strong> must be extended as
described earlier in this chapter. For this reason, the <strong>__getDisplayName($user)</strong> 
must be overridden. The type of the argument is <em>GenericDomainObject</em> and the user
management manager expects it to return the desired display name or the given user as string.
<br />
<br />
To take the email address as a display name, the following code snippet can be used:
<php:highlight>
class MyUmgtManager extends umgtManager
{
   function __getDisplayName($user){
      return $user->getProperty('EMail');
   }
}
</php:highlight>
<br />
<core:importdesign namespace="modules::comments::pres::templates" template="comment" categorykey="en_095" />