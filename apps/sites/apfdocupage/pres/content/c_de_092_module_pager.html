<doku:title tags="dokumentation,module,captcha,gaestebuch,pager,kommentar,social bookmarking,usermanagement" title="Module - Pager" urlname="Module-Pager">
  Der Pager ist eine Komponente, die zur Ausgabe-Steuerung von Datenbank-Eintr&auml;gen verwendet
  werden kann. Diese findet bereits in den Modulen Kommentar-Funktion und G&auml;stebuch Anwendung.
</doku:title>
<core:importdesign namespace="sites::apfdocupage::pres::templates::perspectives::content::voting" template="voting" />
Der Pager ist eine Komponente, die zur Ausgabe-Steuerung von Datenbank-Eintr&auml;gen verwendet werden
kann. Diese findet bereits in den oben genannten Modulen <em>Kommentar-Funktion</em> und <em>G&auml;stebuch</em>
Anwendung. An dieser Stelle sei trotzdem der Aufbau des Moduls und die Verwendung n&auml;her erl&auml;utert.
<br />
<br />
<br />
<a name="4-1-Aufbau"></a><h4>4.1. Aufbau</h4>
Der Pager besteht im wesentlichen aus einer Business-Komponente (<strong>pagerManager</strong>), der
Ausgabe-Komponente f&uuml;r die Pager-HTML-Darstellung (DocumentController
<strong>pager_2_v1_controller.php</strong>) und einer Daten-Schicht, die die f&uuml;r den Betrieb des
Managers notwendigen Informationen aus der Datenbank liest. Um einen Pager verwenden zu k&ouml;nnen
muss dieser zun&auml;chst initialisiert und mit den richtigen Parametern versorgt werden. Diese Arbeit
wird durch die <strong>pagerManagerFabric</strong> erledigt.
<br />
<br />
<br />
<a name="4-2-Konfiguration"></a><h4>4.2. Konfiguration</h4>
Um den PagerManager zum Laden der f&uuml;r eine Seite relevanten Eintr&auml;ge nutzen zu k&ouml;nnen,
muss dieser zun&auml;chst konfiguriert werden. Dazu sind im Wesentlichen eine Konfigurationsdatei und
zwei Statementment-Dateien notwenig. Die Konfigurationsdatei umfasst folgende Parameter:
<pre class="tagexample">
[&lt;Abschnittsname&gt;]
Pager.EntriesPerPage = "&lt;Anzahl&gt;"

Pager.ParameterStartName = "&lt;URL-Parameter&gt;"
Pager.ParameterCountName = "&lt;URL-Parameter&gt;"

Pager.StatementNamespace = "&lt;Statement-Namespace&gt;"
Pager.CountStatement = "&lt;Load-Entries-Count-Statement&gt;"
Pager.CountStatement.Params = "&lt;Statement-Parameter&gt;"
Pager.EntriesStatement = "&lt;Statement-Parameter&gt;"
Pager.EntriesStatement.Params = "&lt;Load-Entry-Statement&gt;"

Pager.DesignNamespace = "&lt;Ausgabe-Template-Namespace&gt;"
Pager.DesignTemplate = "&lt;Ausgabe-Template-Name&gt;"
</pre>
In den beiden Statements werden jeweils definierte Statement-Parameter erwartet, damit der Pager
arbeiten kann. Innerhalb des <em>Load-Entries-Count-Statements</em> k&ouml;nnen beliebiger Parameter
eingesetzt werden um das Ergebnis einzuschr&auml;nken. Diese m&uuml;ssen aber entweder in der
Konfiguration unter <strong>Pager.CountStatement.Params</strong> oder beim Erzeugen des Pagers
&uuml;bergeben werden. Das Ergebnis wird im Offset <strong>EntriesCount</strong> erwartet. Hier muss
also per
<pre class="tagexample">
  SELECT COUNT(Spalte) AS EntriesCount ...
</pre>
gearbeitet werden. Im <em>Load-Entry-Statement</em> muss immer eine LIMIT-Klausel der Form
<pre class="tagexample">
  LIMIT [Start],[EntriesCount]
</pre>
aufgef&uuml;hrt sein. Weiterhin erwartet der Pager auch hier das Ergebnis (ID des Datensatzes) in
einem Offset <strong>DB_ID</strong>. Auch hier muss mit einem Alias der Form
<pre class="tagexample">
  SELECT Spalte AS DB_ID ...
</pre>
gearbeitet werden. Weitere Parameter m&uuml;ssen auch hier entweder in der Konfiguration unter
<strong>Pager.EntriesStatement.Params</strong> oder beim Erzeugen des Pagers &uuml;bergeben werden.
<br />
<br />
<br />
<a name="4-3-Anwendungsbeispiel"></a><h4>4.3. Anwendungsbeispiel</h4>
Ein ausf&uuml;hrliches Anwendungsbeispiele findet sich unter
<a href="./?Seite=032-Kommentarfunktion" title="Kommentar-Funktion">Kommentar-Funktion</a> im Kapitel
4.3. Dabei wird die API des PagerManagers wie folgt verwendet:
<br />
<br />
<strong>Laden der anzuzeigenden IDs:</strong>
<php:highlight>
   // pagerManager holen
   $pMF = &$this->__getServiceObject('modules::pager::biz','pagerManagerFabric');
   $pM = &$pMF->getPagerManager('{CONFIG_SECTION}',array('AddParams' => 'Value'));

   // IDs laden
   $IDs = $pM->loadEntries();

   // Daten laden
   $M = &$this->__getServiceObject('namespace::to::data::component','DataMapper');

   $List = array();

   for($i = 0; $i < count($IDs); $i++){
      $List[] = $M->loadDomainObjectByID($IDs[$i]);
    // end for
   }
</php:highlight>
<br />
<strong>Laden der Business-Objekte mit dem pagerManager:</strong>
<php:highlight>
   // pagerManager holen
   $pMF = &$this->__getServiceObject('modules::pager::biz','pagerManagerFabric');
   $pM = &$pMF->getPagerManager('{CONFIG_SECTION}',array('AddParams' => 'Value'));

   // Daten laden
   $M = &$this->__getServiceObject('namespace::to::data::component','DataMapper');
   $List = $pM->loadEntriesByAppDataComponent($M,'loadDomainObjectByID');
</php:highlight>
<br />
<core:importdesign namespace="modules::comments::pres::templates" template="comment" categorykey="de_092" />