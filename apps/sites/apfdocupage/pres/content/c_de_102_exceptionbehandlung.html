<doku:title tags="exception,behandlung,exceptionbehandlung,registry,core,exceptionhandler" title="Exceptionbehandlung" urlname="Exceptionbehandlung">
  Das Kapitel Exceptionbehandlung beschreibt das im Framework enthaltene Exceptionbehandlung-Konzept und
  zeigt die Verwendung sowie die Erweiterung auf.
</doku:title>
<core:importdesign namespace="sites::apfdocupage::pres::templates::perspectives::content::voting" template="voting" />
<a name="1-Einleitung"></a><h3>1. Einleitung</h3>
Zur globalen Exceptionbehandlung nutzt das Framework die Funktion <strong>exceptionHandler</strong>.
Diese hat die Aufgabe, alle nicht abgefangenen Exceptions an zentraler Stelle zu behandeln. Zu diesem
Zweck nutzt die Funktion eine <strong>ExceptionHandler</strong>-Komponente, die &uuml;ber die Registry
konfigurierbar ist. Letztere ist dann f&uuml;r die eigentliche Behandlung einer Exception verantwortlich.
Der Mechanismus &auml;hnelt der im Framework integrierten
<a href="./?Seite=101-Fehlerbehandlung" title="Fehlerbehandlung">Fehlerbehandlung</a>.
<br />
<br />
Die im APF vorkonfigurierte Exceptionbehandlung beinhaltet dabei die Speicherung der Meldung in einer
Log-Datei und die Ausgabe der nicht abgefangenen Exception inklusive des Stacktraces. Details
k&ouml;nnen der <a href="./?Seite=002-API-Dokumentation" title="API-Dokumentation">API-Dokumentation</a>
der Klasse <strong>DefaultExceptionHandler</strong> entnommen werden.
<br />
<br />
<br />
<a name="2-Konfiguration"></a><h3>2. Konfiguration</h3>
Um den vorkonfigurierten <strong>DefaultExceptionHandler</strong> durch einen eigenen zu ersetzen
muss der Registry-Offset <strong>ExceptionHandler</strong> im Namespace <strong>apf::core</strong>
mit der gew&uuml;nschten <strong>ExceptionHandlerDefinition</strong> ersetzt werden. Die Konfiguration
einer eigenen Exceptionbehandlungsroutine muss dabei in der Bootstrap-Datei nach dem Einbinden der
<em>pagecontroller.php</em> erfolgen.
<br />
<br />
Die Definition einer eigenen Exception-Behandlungskomponente gestaltet sich wie folgt:
<php:highlight>
$reg = Singleton::getInstance('Registry');
$reg->register(
   'apf::core',
   'ExceptionHandler',
   new ExceptionHandlerDefinition(
      'my::exceptionhandler::namespace',
      'MyExceptionHandler'
   )
);
</php:highlight>
Wie aus dem Code-Beispiel zu erkennen ist, wird ein <em>ExceptionHandler</em> durch seinen Namespace
und seinen Klassennamen referenziert.
<br />
<br />
<strong>Hinweis:</strong> enth&auml;lt der Registry-Offset keine g&uuml;ltige Definition, werden
auftretende Exceptions in Text-Form ausgegeben. Der Fallback-Modus ist daran zu erkennen, dass die
Meldung mit
<code:highlight>
APF catchable exception:
</code:highlight>
beginnt. In diesem Fall muss die Definition oder die Implementierung der ExceptionHandler-Klasse
&uuml;berpr&uuml;ft werden.
<br />
<br />
<br />
<a name="3-Erweiterung"></a><h3>3. Erweiterung</h3>
Um eine eigene Exceptionbehandlung einzuf&uuml;hren, muss die Klasse <strong>AbstractExceptionHandler</strong>
implementiert werden. Diese definiert folgendes Interface:
<php:highlight>
abstract class AbstractExceptionHandler extends coreObject
{

   function handleException($exception){
   }

}
</php:highlight>
Bei Auftreten einer Exception wird der Methode <strong>handleException</strong> das Exception-Objekt
&uuml;bergeben. Da die Exceptionbehandlung in einer eigenen Klasse stattfindet, die nicht mit dem
ServiceManager erzeugt wurde, steht der Zugriff auf den aktuellen <strong>Context</strong> und die
aktuelle <strong>Sprache</strong> <u>nicht</u> zur Verf&uuml;gung!
<br />
<br />
Sollten diese Informationen f&uuml;r die Behandlung der Exception notwendig sein, m&uuml;ssen diese
&uuml;ber in einer Applikation verf&uuml;gbaren Informationscontainer (z.B. Model-Klasse eines Modules)
bezogen werden. Der Umgebungsparameter steht wie in der Dokumentation beschrieben &uuml;ber die
Registry zur Verf&uuml;gung.
<br />
<br />
<br />
<a name="4-Anwendung"></a><h3>4. Anwendung</h3>
Der globale Exception-Behandlungsmechanismus kann einfach durch folgenden PHP-Code genutzt werden:
<php:highlight>
throw new Exception('My application exception');
</php:highlight>
Vorraussetzung dabei ist, dass die durch den Code geworfene Exception nicht durch ein
<em>try-catch</em>-Konstrukt abgefangen wird!
<br />
<br />
Details k&ouml;nnen der Online-Dokumentation unter
<doku:link>http://php.net/exception</doku:link> und <doku:link>http://php.net/exceptions</doku:link>
entnommen werden.
<br />
<br />
<br />
<core:importdesign namespace="modules::comments::pres::templates" template="comment" categorykey="de_102" />