<doku:title parent="119" tags="exception,behandlung,exceptionbehandlung,registry,core,exceptionhandler" title="Exceptionbehandlung" urlname="Exceptionbehandlung">
  Das Kapitel Exceptionbehandlung beschreibt das im Framework enthaltene Exceptionbehandlung-Konzept und
  zeigt die Verwendung sowie die Erweiterung auf.
</doku:title>
<h3 id="Chapter-1-Einleitung"><a href="#Chapter-1-Einleitung">1. Einleitung</a></h3>
Zur globalen Exceptionbehandlung nutzt das Framework die Funktion <strong>exceptionHandler</strong>.
Diese hat die Aufgabe, alle nicht abgefangenen Exceptions an zentraler Stelle zu behandeln. Zu diesem
Zweck nutzt die Funktion eine <strong>ExceptionHandler</strong>-Komponente, die &uuml;ber die Registry
konfigurierbar ist. Letztere ist dann f&uuml;r die eigentliche Behandlung einer Exception verantwortlich.
Der Mechanismus &auml;hnelt der im Framework integrierten
<a href="./?Seite=101-Fehlerbehandlung" title="Fehlerbehandlung">Fehlerbehandlung</a>.
<br />
<br />
Die im APF vorkonfigurierte Exceptionbehandlung beinhaltet dabei die Speicherung der Meldung in einer
Log-Datei und die Ausgabe der nicht abgefangenen Exception inklusive des Stacktraces. Details
k&ouml;nnen der <a href="./?Seite=002-API-Dokumentation" title="API-Dokumentation">API-Dokumentation</a>
der Klasse <strong>DefaultExceptionHandler</strong> entnommen werden.
<br />
<br />
<br />
<h3 id="Chapter-2-Konfiguration"><a href="#Chapter-2-Konfiguration">2. Konfiguration</a></h3>
Um den vorkonfigurierten <strong>DefaultExceptionHandler</strong> durch einen eigenen zu ersetzen
muss der Registry-Offset <strong>ExceptionHandler</strong> im Namespace <strong>apf::core</strong>
mit der gew&uuml;nschten <strong>ExceptionHandlerDefinition</strong> ersetzt werden. Die Konfiguration
einer eigenen Exceptionbehandlungsroutine muss dabei in der Bootstrap-Datei nach dem Einbinden der
<em>pagecontroller.php</em> erfolgen.
<br />
<br />
Die Definition einer eigenen Exception-Behandlungskomponente gestaltet sich wie folgt:
<gen:highlight type="php">
Registry::register(
   'apf::core',
   'ExceptionHandler',
   new ExceptionHandlerDefinition(
      'my::exceptionhandler::namespace',
      'MyExceptionHandler'
   )
);
</gen:highlight>
Wie aus dem Code-Beispiel zu erkennen ist, wird ein <em>ExceptionHandler</em> durch seinen Namespace
und seinen Klassennamen referenziert.
<br />
<br />
<strong>Hinweis:</strong> enth&auml;lt der Registry-Offset keine g&uuml;ltige Definition, werden
auftretende Exceptions in Text-Form ausgegeben. Der Fallback-Modus ist daran zu erkennen, dass die
Meldung mit
<gen:highlight type="apf-xml">
APF catchable exception:
</gen:highlight>
beginnt. In diesem Fall muss die Definition oder die Implementierung der ExceptionHandler-Klasse
&uuml;berpr&uuml;ft werden.
<br />
<br />
<div class="hint">
   Um den <em>ExceptionHandler</em> zu deaktivieren kann der Registry-Eintrag mit
   <strong>null</strong> initialisiert werden.
   <br />
   <br />
</div>
<br />
<br />
<h3 id="Chapter-3-Erweiterung"><a href="#Chapter-3-Erweiterung">3. Erweiterung</a></h3>
Um eine eigene Exceptionbehandlung einzuf&uuml;hren, muss die Klasse <strong>AbstractExceptionHandler</strong>
implementiert werden. Diese definiert folgendes Interface:
<gen:highlight type="php">
abstract class AbstractExceptionHandler extends APFObject
{

   function handleException($exception){
   }

}
</gen:highlight>
Bei Auftreten einer Exception wird der Methode <strong>handleException</strong> das Exception-Objekt
&uuml;bergeben. Da die Exceptionbehandlung in einer eigenen Klasse stattfindet, die nicht mit dem
ServiceManager erzeugt wurde, steht der Zugriff auf den aktuellen <strong>Context</strong> und die
aktuelle <strong>Sprache</strong> <em>nicht</em> zur Verf&uuml;gung!
<br />
<br />
Sollten diese Informationen f&uuml;r die Behandlung der Exception notwendig sein, m&uuml;ssen diese
&uuml;ber in einer Applikation verf&uuml;gbaren Informationscontainer (z.B. Model-Klasse eines Modules)
bezogen werden. Der Umgebungsparameter steht wie in der Dokumentation beschrieben &uuml;ber die
Registry zur Verf&uuml;gung.
<br />
<br />
<br />
<h3 id="Chapter-4-Anwendung"><a href="#Chapter-4-Anwendung">4. Anwendung</a></h3>
Der globale Exception-Behandlungsmechanismus kann einfach durch folgenden PHP-Code genutzt werden:
<gen:highlight type="php">
throw new Exception('My application exception');
</gen:highlight>
Vorraussetzung dabei ist, dass die durch den Code geworfene Exception nicht durch ein
<em>try-catch</em>-Konstrukt abgefangen wird!
<br />
<br />
Details k&ouml;nnen der Online-Dokumentation unter
<doku:link>http://php.net/exception</doku:link> und <doku:link>http://php.net/exceptions</doku:link>
entnommen werden.
<br />
<br />
<br />
<core:importdesign namespace="modules::comments::pres::templates" template="comment" categorykey="de_102" />