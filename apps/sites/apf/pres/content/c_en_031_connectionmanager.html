<doku:title parent="119" tags="documentation,class reference,classes,reference,singleton,connectionmanager" title="connectionManager" urlname="connectionManager">
  The conceptual goal of the connection manager is, to define conventions like the configuration and
  the addressing of the database access layer. In best case, the database layer of an application
  can be replaced with another wothout changing any line of code.
</doku:title>
The notion of the connectionManager is to define the configuration and implementation of a database
abstraction and access layer. Ideally, this approach eases switching from one database driver to
another.
<br />
<br />
Despite the fact, that this procedure is described a little bit too idealistic - different databases
often have different features - the connectionManager itself gives a common understanding of how an
application's data layer should communicate with the database abstraction layer.
<br />
<br />
<br />
<h3 id="Chapter-1-Configuration"><a href="#Chapter-1-Configuration">1. Configuration</a></h3>
The <strong>connectionManager</strong> is a kind of factory to concrete implementations of database
driver classes. To load the desired driver the abstraction layer must be configured using the config
file
<gen:highlight type="code">/config/core/database/{CONTEXT}/{ENVIRONMENT}_connections.ini</gen:highlight>
Details on configuration files can be found in the
<a href="./?Page=033-Configuration" title="Configuration">configuration</a> chapter. The configuration
file mentioned above must contain one section for each driver layer:
<gen:highlight type="ini">
[sectionname]
DB.Host = ""
DB.User = ""
DB.Pass = ""
DB.Name = ""
[DB.DebugMode = "true|false"]
</gen:highlight>
The <strong>sectionsname</strong> is used to create the driver instance, <strong>DB.Host</strong>
contains the hostname of the database server, <strong>DB.User</strong> and <strong>DB.Pass</strong>
define the logon credentials and <strong>DB.Name</strong> defines the name of the database to use.
<strong>DB.Type</strong> is aimed to switch the debug mode on of off.
<div class="hint">
   The debug mode can be used to display the executed statement directly on screen. If you like to
   monitor the statements executes, you may use the optional parameter <em>$logStatement</em> applied
   to the <em>executeStatement()</em> and <em>executeTextStatement()</em> method. If set to
   <em>true</em>, the currently executed statement is appended to a log file. Details on the function
   can be obtained from the <int:link pageid="002" />.
</div>

<h3 id="Chapter-2-Practice"><a href="#Chapter-2-Practice">2. Practice</a></h3>
To be able to use the <strong>connectionManager</strong> the component must be imported by
<gen:highlight type="php">
  import('core::database','connectionManager');
</gen:highlight>
prior to use. Further, you can create a database driver instance using the following code snippet:
<gen:highlight type="php">
  $cM = &$this->__getServiceObject('core::database','connectionManager');
  $db_driver = &$cM->getConnection('sectionname');
</gen:highlight>
<br />
<h3 id="Chapter-3-Extending-database-drivers"><a href="#Chapter-3-Extending-database-drivers">3. Extending the database drivers</a></h3>
The class <strong>AbstractDatabaseHandler</strong> describes the interface of a database driver that
can be created using the <strong>connectionManager</strong>. In order to implement another
abstraction layer any other driver must inherit from <strong>AbstractDatabaseHandler</strong> and
reside in the <strong>core::database</strong> namespace.
<br />
<br />
<br />
<h3 id="Chapter-4-Existing-abstraction-layers"><a href="#Chapter-4-Existing-abstraction-layers">4. Existing abstraction layers</a></h3>
The adventure php framework comes with two different abstraction layers:
<ul>
  <li>MySQLx: MySQL driver. Based on the mysql_* functions.</li>
  <li>SQLite: SQLite driver. Based on the sqlite_* functions. Needs PHP > 5.0.0!</li>
</ul>
<br />
<h4 id="Chapter-4-1-MySQL-driver"><a href="#Chapter-4-1-MySQL-driver">4.1. MySQL driver</a></h4>
In order to create an instance of the MySQL abstraction class the following configuration has to
be included in the config file mentioned above:
<gen:highlight type="ini">
[MySQL]
DB.Host = "host"
DB.User = "user"
DB.Pass = "pass"
DB.Name = "name"
DB.Type = "MySQLx"
[DB.DebugMode = "true|false"]
[DB.Charset = ""]
[DB.Collation = ""]
</gen:highlight>
The two parameters <strong>DB.Charset</strong> and <strong>DB.Collation</strong> are used to
configure the <em>character set</em> and the <em>collation</em> of the MySQL connection. The
directive <strong>DB.Charset</strong> sets the MySQL variables
<ul>
   <li>character_set_client</li>
   <li>character_set_connection</li>
   <li>character_set_results</li>
</ul>
and the value of <strong>DB.Collation</strong> is applied to the variables
<ul>
   <li>collation_connection</li>
   <li>collation_database</li>
</ul>
Both params are optional and can be defined alternately. There is no need to specify both params at
the same time.
<div class="hint">
   Details on the configuration param values can be taken from the MySQL documentation within
   chapter
   <a class="external" href="http://dev.mysql.com/doc/refman/5.0/en/charset-connection.html" title="Connection Character Sets and Collations (MySQL 5.0)">Connection Character Sets and Collations (MySQL 5.0)</a>.
</div>
Afterwards, the instance of the abstraction layer can be created using the following lines of code:
<gen:highlight type="php">
  $cM = &$this->__getServiceObject('core::database','connectionManager');
  $MySQL = &$cM->getConnection('MySQL');
</gen:highlight>
Due to performance issues, the connection manager only creates singleton drivers.
<br />
<br />
<br />
<h4 id="Chapter-4-2-SQLite-driver"><a href="#Chapter-4-2-SQLite-driver">4.2. SQLite driver</a></h4>
Any SQLite abstraction layer instance can be configured by
<gen:highlight type="ini">
[SQLite]
DB.Name = "/path/to/my/database.sqlite"
DB.Type = "SQLite"
DB.DebugMode = "true|false"
</gen:highlight>
Please note, that host, user and password don't have to be configured, due to the fact, that SQLite
is an integrated database engine. Creating an instance of the driver class looks like this:
<gen:highlight type="php">
  $cM = &$this->__getServiceObject('core::database','connectionManager');
  $SQLite = &$cM->getConnection('SQLite');
</gen:highlight>
<br />
<core:importdesign namespace="modules::comments::pres::templates" template="comment" categorykey="en_031" />