<doku:title parent="119" tags="controller,goal,mvc,templates,forms,dynamic lists,generic,flexibility" title="(Document-)Controller" urlname="Controller">
  A (document-) controller is the controller class of the MVC pattern. It can be used to dynamically
  generate content within a APF DOM node. Nevertheless, you are free to decide of you use controllers
  or taglibs to dynamically generate content.
</doku:title>
<h3 id="Chapter-1-Aim-of-a-controller"><a href="#Chapter-1-Aim-of-a-controller">1. Aim of a (document-)controller</a></h3>
<p>
   As mentioned under <int:link pageid="046" /> and described on the
   <int:link pageid="047">templates page</int:link> controller according to the MVC
   paradigma are userd to generate dynamic content. To be able to perceive this task a document
   controller must be "announced" to a DOM node. This happens in the first line of a template file by
   using the <strong>&lt;@controller @&gt;</strong> tag. The page controller then assigns the document
   controller given there to the topical DOM node and executes it within the transformation of the
   current node.
</p>

<h3 id="Chapter-2-Design-of-a-controller"><a href="#Chapter-2-Design-of-a-controller">2. Design of a (document-)controller</a></h3>
<p>
   Each document controller inherits from the basic document controller <em>base_controller</em>. This
   class implements a lot of helpful methods to generate dynamic content.
   Example for this is the function <strong>getTemplate()</strong> that returns a reference of a
   HTML template contained in the node, or the method <strong>setPlaceHolder()</strong> that can be used
   to fill a place holder defined via the <strong>&lt;html:placeholder /&gt;</strong> tag.
</p>
<p>The scaffolding of a document controller has the always following figure:</p>
<gen:highlight type="php">
class my_document_controller extends base_controller {

   public function transformContent(){
   }

}
</gen:highlight>
<p>
   A document controller is, in principle, a PHP class "like anyone else". To the developer it is
   considered freely to define own class variables, to introduce own methods and to integrate other
   classes. It is important that only the interface shown before is implemented.
</p>
<p>
   As described in the <int:link pageid="002" /> the <em>base_controller</em> has four important
   helper methodes:
</p>
<ul>
  <li>
    <strong>getTemplate():</strong>
    <br />
    Method to get a reference of a HTML template object.
  </li>
  <li>
    <strong>getForm():</strong>
    <br />
    Function to get a reference of a form object defined within the current template file.
  </li>
  <li>
    <strong>__placeholderExists():</strong>
    <br />
    This method checks whether a place holder tag exists in the current template file.
  </li>
  <li>
    <strong>__templatePlaceholderExists():</strong>
    <br />
    Tests if a specific placeholder exists in a given template.
  </li>
</ul>
<p>
   Moreover, the <em>base_controller</em> inherits all attributes and functions of the class <em>APFObject</em>.
</p>
<div class="hint">
   <p>
      Besindes, each document controller instance contains a reference on the current DOM node the
      controller is responsible for transformation. The reference is stored in the 
      <em>$this->__Document</em> variable. Using this reference, you can access the document's
      <em>foo</em> attribute via
      <gen:highlight type="php">$this->__Document->getAttribute('foo')</gen:highlight>
   </p>
   <p>
      Due to usability reasons, the document controller also knows all attributes of the current
      document to transform. These are stored within the internal class variable
      <em>$this->__Attributes</em> and can directly be accessed within the document controller.
   </p>
</div>

<h3 id="Chapter-3-Examples"><a href="#Chapter-3-Examples">3. (Document-)controller example</a></h3>
<h4 id="Chapter-3-1-Dynamic-meta-tags"><a href="#Chapter-3-1-Dynamic-meta-tags">3.1. Representation of dynamic meta tags</a></h4>
<p>
   This chapter now describes the controller implementation of the template example shown in chapter
   2.1 on the <int:link pageid="047" /> page. In addition the template is to be extended by the
   definition of the document controller at first and looks, hence, as follows:
</p>
<gen:highlight type="apf-xml">
&lt;@controller namespace="sites::apfdocupage::pres::templates::documentcontroller" file="website_v1_controller"
class="website_v1_controller" @&gt;
[..]
&lt;meta name="keywords" lang="de" content="PHP,Framework,Page-Controller,Front-Controller,Pattern,[..]" /&gt;
&lt;meta name="date" content="&lt;html:placeholder name="Date" /&gt;" /&gt;
&lt;meta name="robots" content="index,follow" /&gt;
&lt;meta name="revisit-after" content="5 days" /&gt;
[..]
</gen:highlight>
In this case the accompanying document controller implements merely the method
<strong>transformContent()</strong> which is called during the transformation. The source code of
the class looks as follows:
<br />
<gen:highlight type="php">
class website_v1_controller extends base_controller {

   public function transformContent(){

      // Set placeholder "URI"
      $this->setPlaceHolder('URI',$_SERVER['REQUEST_URI']);

      // Set placeholder "Date"
      $this->setPlaceHolder('Date',date('Y-m-d'));

   }

}
</gen:highlight>
<br />
<h4 id="Chapter-3-2-Dynamic-lists"><a href="#Chapter-3-2-Dynamic-lists">3.2. Display of dynamic lists</a></h4>
The following lines hak back on the example on the <a href="./?Page=047-Templates" title="templates">templates page</a>,
chapter 2.2. The template described there aimed to generate a list. In addition the template -
like above - must be extended by the definition the of document controller at first:
<br />
<br />
<gen:highlight type="apf-xml">
&lt;@controller namespace="sites::apfdocupage::pres::templates::documentcontroller" file="list_v1_controller"
class="list_v1_controller" @&gt;
[..]
&lt;html:placeholder name="List" /&gt;

&lt;html:template name="ListHeader"&gt;
  &lt;table cellpadding="0" cellspacing="0" border="0"&gt;
    &lt;tr&gt;
      &lt;td&gt;
         &lt;strong&gt;ExampleList&lt;/strong&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
    &lt;template:placeholder name="TableElements" /&gt;
  &lt;/table&gt;
&lt;/html:template&gt;

&lt;html:template name="ListItem"&gt;
    &lt;tr&gt;
      &lt;td&gt;
         &lt;template:placeholder name="ItemValue" /&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
&lt;/html:template&gt;
</gen:highlight>
Now the corresponding document controller implements on the one hand the method <em>transformContent()</em>,
however, and is extended with the private methods <strong>__buildList()</strong> and
<strong>__buildListItem()</strong>. So the tasks are packed in own "helper methods" and the code
gets more clear and better readably though.
The loading of the list is delegated to a fictive business component called <strong>listLoader</strong>
which returns a list (=array) of <strong>listItem</strong> objects. The latter is a data object which
inherits from <em>APFObject</em> and exactly has one attribute with the name <strong>ListContent</strong>.
To get the attribute of each object the generic <em>get()</em> methode can be used. Then the list
is walked through and the HTML code is generated:
<br />
<gen:highlight type="php">
import('sites::demosite::biz','listLoader');

class list_v1_controller extends base_controller {

   public function transformContent(){

      // Set list to placehodler "List"
      $this->setPlaceHolder('List',$this->buildList());

   }

   private function buildList(){

      // Create listLoader
      $listLoader = &$this->getServiceObject('sites::demosite::biz','listLoader');

      // Load list
      $List = $listLoader->loadList();

      // Initialize HTML buffer
      $Buffer = (string)'';

      // Get a reference of the "Header" template
      $Template__ListHeader = &$this->getTemplate('ListHeader');

      // Walk through the list and generate an item
      foreach($List as $lKey => $lItem){

         // Generate the HTML code of an item and add it to the buffer
         $Buffer .= $this->buildListItem($lItem);

      }

      // Set items into the "Header" template
      $Template__ListHeader->setPlaceHolder('TableElements',$Buffer);

      // Transform the template transformieren and return the code
      return $Template__ListHeader->transformTemplate();

   }

   private function buildListItem(&$listItem){

      // Get a reference if the "ListItem" template
      $Template__ListItem = &$this->getTemplate('ListItem');

      // Fill place holder of the template
      $Template__ListItem->setPlaceHolder('ItemValue',$listItem->get('ListContent'));

      // Transform the template transformieren and return the code
      return $Template__ListItem->transformTemplate();

   }

}
</gen:highlight>

<h4 id="Chapter-3-3-More-examples"><a href="#Chapter-3-3-More-examples">3.3. More examples</a></h4>
<p>
   To get specific examples of the benefit please have a look at the
   <int:link pageid="057" /> and <int:link pageid="035" /> pages. More information about forms can 
   be found on the page <int:link pageid="113" />.
</p>

<core:importdesign namespace="modules::comments::pres::templates" template="comment" categorykey="en_006" />