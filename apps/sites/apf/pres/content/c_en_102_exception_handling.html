<doku:title parent="119" tags="exception,handling,exception handling,registry,core,exceptionhandler" title="Exception handling" urlname="Exception-handling">
  The exception handling chapter describes the exception handling contained in the framework to
  catch uncaught exceptions. Further, this section describes the usage of the concept and the
  extension.
</doku:title>
<div class="hint">
   Please note that the documentation on this page refers to releases including 1.14. For newer releases, please see
   <int:link pageid="144"/>.
</div>

<h3 id="Chapter-1-Introduction"><a href="#Chapter-1-Introduction">1. Introduction</a></h3>
<p>
   The framework features the <strong>exceptionHandler</strong> function, that is intended to do global
   exception handling. This function is used to catch and handle uncaught exceptions at a central
   place. For this reason, it uses an <strong>ExceptionHandler</strong> component, that can be configured
   within the registry. The exception handler itself is then responsible for the handling of the current
   exception. This mechanism is similar to the integrated
   <a href="./?Page=101-Error-handling" title="Error handling">error handling</a>.
</p>
<p>
   The preconfigured APF exception handler saves the exception message into a log file and displays the
   nice exception screen including the stacktrace. Details can be taken from the
   <int:link pageid="002" /> of the
   <strong>DefaultExceptionHandler</strong> class.
</p>

<h3 id="Chapter-2-Configuration"><a href="#Chapter-2-Configuration">2. Configuration</a></h3>
<p>
   To replace the preconfigured <strong>DefaultExceptionHandler</strong> with an own class, the registry
   offset <strong>ExceptionHandler</strong> within the <strong>apf::core</strong> namespace must be filled
   with the desired <strong>ExceptionHandlerDefinition</strong> instance. The configuration of the exception
   handling component must be placed in the bootstrap file directly after the <em>pagecontroller.php</em>
   is included.
</p>
<p>The definition of a custom exception handler looks as follows:</p>
<gen:highlight type="php">
Registry::register(
   'apf::core',
   'ExceptionHandler',
   new ExceptionHandlerDefinition(
      'my::exceptionhandler::namespace',
      'MyExceptionHandler'
   )
);
</gen:highlight>
<p>
   As you can take from the example, the desired <em>ExceptionHandler</em> is referenced by it's
   namespace and it's class name.
</p>
<div class="hint">
   If the registry offset does not contain a valid definition, the exceptions are
   displayed in text mode. You can identify the fallback mode by the prefix
   <gen:highlight type="apf-xml">
   APF catchable exception:
   </gen:highlight>
   In this cases, the definition or the implementation of the exception handler class must be checked.
</div>

<div class="hint">
   In order to deactivate the <em>ExceptionHandler</em>, initilize the registry offset with
   <strong>null</strong>.
</div>

<h3 id="Chapter-3-Enhancement"><a href="#Chapter-3-Enhancement">3. Enhancement</a></h3>
<p>
   To introduce a custom exception handling, you must implement the <strong>AbstractExceptionHandler</strong>.
   This class defines the following interface:
</p>
<gen:highlight type="php">
abstract class AbstractExceptionHandler extends APFObject {

   public function handleException($exception){
   }

}
</gen:highlight>
<p>
   If an error occures, the <strong>handleException</strong> is applied the current exception object
   as an argument. Due to the fact, that the exception handling is done in an page controller independent
   class, that is not created by the service manager, the current <strong>Context</strong> and the current
   <strong>Language</strong> are <em>not</em> available!
</p>
<p>
   If these information are important for the exception handling, the must be obtained from information
   containers available within an application or module (e.g. application model class). The environment
   param is available via the registry as mentioned in the corresponding documentation chapter.
</p>

<h3 id="Chapter-4-Usage"><a href="#Chapter-4-Usage">4. Usage</a></h3>
<p>
   The global exception handling mechanism can be used by placing the following PHP code within your
   application:
</p>
<gen:highlight type="php">
throw new Exception('My application exception');
</gen:highlight>
<p>
   Please note, that the global exception handler only is invoked, when the current exception is not
   caught by a <em>try-catch</em> block!
</p>
<p>Details on the usage of exceptions can be taken from the online documentation under</p>
<doku:link>http://php.net/exception</doku:link> and <doku:link>http://php.net/exceptions</doku:link>.

<h3 id="Chapter-5-Production-ExceptionHandler"><a href="#Chapter-5-Production-ExceptionHandler">5. Production ExceptionHandler</a></h3>
<p>
   In parallel to to the <int:link pageid="101" anchor="Chapter-5-1-ProductionErrorHandler">ProductionErrorHandler</int:link>
   the APF ships an ExceptionHandler for production environments since 1.13.
</p>
<p>
   After including the <em>pagecontroller.php</em> the <em>ProductionExceptionHandler</em> can be
   activated as follows:
</p>
<gen:highlight type="php">
Registry::register(
   'apf::core',
   'ExceptionHandler',
   new ExceptionHandlerDefinition(
      'core::exceptionhandler',
      'ProductionExceptionHandler'
   )
);
Registry::register(
   'apf::core::exceptionhandler',
   'ProductionExceptionRedirectUrl',
   '/pages/global-error'
);
</gen:highlight>
<p>
   In case the registry directive <em>ProductionExceptionRedirectUrl</em> is not set the ExceptionHandler redirects
   to &quot;/&quot;.
</p>

<core:importdesign namespace="modules::comments::pres::templates" template="comment" categorykey="en_102" />