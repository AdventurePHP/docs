<doku:title parent="119" tags="dokumentation,klassen referenz,klassen,referenz,imagemanager" title="ImageManager (bis 1.8)" urlname="ImageManager-bis-1-8">
  Der ImageManager implementiert Methoden zur Bearbeitung von Bildern. Hierbei werden sowohl JPG und
  GIF als auch PNG-Bilder unterstützt, sofern die PHP-GD-Library in den entsprechenden Version
  verfügbar ist.
</doku:title>
Der <strong>ImageManager</strong> implementiert Methoden zur Bearbeitung von Bildern. Hierbei werden
sowohl JPG und GIF als auch PNG-Bilder unterstützt, sofern die PHP-GD-Library in den entsprechenden
Version verfügbar ist. Der <strong>ImageManager</strong> muss vor der Verwendung per
<gen:highlight type="php">
  import('tools::image','ImageManager');
</gen:highlight>
eingebunden werden. Um die Klasse verwenden zu können muss diese instanziiert werden. Lediglich
die Methode <strong>getImageAttributes()</strong> kann statisch benutzt werden. Für
die Bearbeitung von Bildern stehen folgende Methoden zur Verfügung:
<ul>
  <li>
    <strong>setImageSize()</strong>:
    <br />
    Setzt die Ziel-Maße für das Bearbeiten von Bildern mit <em>resizeImage()</em>.
  </li>
  <li>
    <strong>generateThumbnail()</strong>:
    <br />
    Erzeugt ein Thumbnail nach der Nameskonvention <em>{Bisherige Dateiname minus Endung}_thumb.{Endung}</em>
    in einem übergebenen Ordner.
  </li>
  <li>
    <strong>showImageAttributes()</strong> (statisch):
    <br />
    Zeigt Bild-Attribute wie Breite, Höhe, Type u.s.w. an.
  </li>
  <li>
    <strong>resizeImage()</strong>:
    <br />
    Vergrößert oder verkleinert ein gegebenes Bild unter Berücksichtigung eines
    Zieldateinamens.
  </li>
  <li>
    <strong>setJPGQuality()</strong>:
    <br />
    Konfiguriert die Qualität eines JPG-Bildes während einer JPG-Komprimierung.
    Standard-Qualität ist 80%.
  </li>
</ul>
Ein typischer Anwendungsfall ist das Ausliefern von Bildern über eine PHP-Datei unter Angabe von
Bildmaßen. Im folgenden Skript wird davon ausgegeben, dass dieses immer mit korrekten und
vollständigen Parametern aufgerufen wird. Weitergehende Prüfungen sind nicht enthalten.
<gen:highlight type="php">
  // Einbinden des ImageManagers
  import('tools::image','ImageManager');

  // Gemeinsamen Bild-Basis-Pfad definieren
  $imageBasePath = '../pics';

  // Cache-Ordner definieren
  $imageCacheFolder = '../pics_cache';

  // Parameter 'image' lokal verfuegbar machen
  $image = (string)$_REQUEST['image'];

  // Pruefen, ob Datei existiert
  if(file_exists($imageBasePath.'/'.$image)){

     // Bildmasse holen
     $ImageInfo = ImageManager::showImageAttributes($imageBasePath.'/'.$image);

     // Breite setzen
     $width = (int)$_REQUEST['width'];

     // Hoehe setzen
     $height = (int)$_REQUEST['hight'];

  }
  else{
     trigger_error('The file specified with the parameter \'image\' does not exist in the image
                    path \''.$imageBasePath.'\'!',E_USER,ERROR);
     exit(1);
  }

  // Cache-Key erzeugen
  $cacheKey = md5($image).'.'.$ImageInfo['Extension'];

  // Cache prüfen
  if(file_exists($imageCacheFolder.'/'.$cacheKey)){

     // ImageManager erzeugen
     $iM = new ImageManager($width,$height);

     // Bild resizen und cachen
     $cachedImage = $iM->resizeImage($imageBasePath.'/'.$image,$imageCacheFolder,$cacheKey);

  }


  // ContentType zusammensetzen
  switch($ImageInfo['Extension']){

     case 'gif':
        $ContentType = 'image/gif';
        break;
     case 'jpg':
        $ContentType = 'image/jpg';
        break;
     case 'jpeg':
        $ContentType = 'image/jpg';
        break;
     case 'png':
        $ContentType = 'image/png';
        break;
     default:
        $ContentType = 'application/octet-stream';
        break;

  }

  // Header ausgeben
  header('Content-Type: '.$ContentType);
  header('Content-disposition: inline; filename="'.$image.'"');
  header('Content-Transfer-Encoding: binary');
  header('Content-Length: '.filesize($imageCacheFolder.'/'.$cacheKey));

  // Bild ausgeben
  @readfile($imageCacheFolder.'/'.$cacheKey);

  // Ausgabe beenden
  exit();

</gen:highlight>
<br />
<core:importdesign namespace="APF\modules\comments\pres\templates" template="comment" categorykey="de_105" />